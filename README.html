<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-03-10 Ne 13:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My System Config</title>
<meta name="author" content="(Î» () nil)" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">My System Config</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org424cb29">1. Introduction</a>
<ul>
<li><a href="#org8d6151c">1.1. The why</a>
<ul>
<li><a href="#org52258f2">Reproducibility</a></li>
<li><a href="#org9d1f4b7">Separation</a></li>
<li><a href="#orgbfbac34">Modularity</a></li>
<li><a href="#org8c01428">Organization</a></li>
<li><a href="#orgd7600e3">Maintainability</a></li>
</ul>
</li>
<li><a href="#org80d10dd">1.2. The implementation</a>
<ul>
<li><a href="#orga58e3ee">README.org</a></li>
<li><a href="#org659c9e4">Modules</a></li>
<li><a href="#org3563cff">Packages</a></li>
<li><a href="#org754c69b">Deployment</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8ee2f26">2. Autostart</a>
<ul>
<li><a href="#org6a796f3">2.1. .config/autostart/autostart.desktop</a></li>
<li><a href="#org29b62a5">2.2. .loginctl</a></li>
</ul>
</li>
<li><a href="#org601d709">3. Bash</a>
<ul>
<li><a href="#org202e160">3.1. .bashrc</a></li>
<li><a href="#org5ea9f14">3.2. .bash profile</a></li>
</ul>
</li>
<li><a href="#org1419738">4. Custom Binaries</a>
<ul>
<li><a href="#orgbf4fa58">4.1. .bin/scr</a></li>
<li><a href="#orgfafe2d4">4.2. .bin/scr-area</a></li>
<li><a href="#orgd008264">4.3. .bin/chromium-incognito</a></li>
</ul>
</li>
<li><a href="#org2c1065a">5. Containers</a>
<ul>
<li><a href="#orgeb7babd">5.1. .config/containers/policy.json</a></li>
<li><a href="#orgb09b3e6">5.2. .config/containers/registries.conf</a></li>
</ul>
</li>
<li><a href="#org6020da8">6. Dictionaries</a></li>
<li><a href="#org8148c21">7. Debian Dependencies</a></li>
<li><a href="#orgec1aae8">8. Firefox</a></li>
<li><a href="#org4821721">9. Fonts</a></li>
<li><a href="#org6dee77c">10. Gtk</a></li>
<li><a href="#org4bf02e2">11. Guix</a>
<ul>
<li><a href="#org48b7506">11.1. .guix-manifest</a></li>
<li><a href="#org3b5d902">11.2. .guix-manifest-tiny</a></li>
<li><a href="#org0be4001">11.3. .config/guix/channels.scm</a></li>
</ul>
</li>
<li><a href="#org53f849c">12. Guix-run</a>
<ul>
<li><a href="#org2b1965c">12.1. .bin/guix-run</a></li>
</ul>
</li>
<li><a href="#org056fb13">13. Sway</a>
<ul>
<li><a href="#orge6db0ea">13.1. .config/sway/config</a></li>
<li><a href="#org9a9a52d">13.2. .config/sway/i3status wrapper.py</a></li>
<li><a href="#orgf4f93d9">13.3. .config/i3status/config</a></li>
</ul>
</li>
<li><a href="#orgdd2db68">14. Icons</a></li>
<li><a href="#org32723e6">15. Rofi</a>
<ul>
<li><a href="#org4e8b2c9">15.1. .config/wofi/nord.rasi</a></li>
</ul>
</li>
<li><a href="#orgad52703">16. Startx</a>
<ul>
<li><a href="#org96cfcc5">16.1. .startx</a></li>
</ul>
</li>
<li><a href="#org59576ac">17. Xresources</a>
<ul>
<li><a href="#orga166c8f">17.1. .Xresources</a></li>
<li><a href="#org9186016">17.2. .xsessionrc</a></li>
</ul>
</li>
<li><a href="#org9228135">18. XFCE 4 Terminal</a></li>
<li><a href="#org0402567">19. Wallpapers</a></li>
<li><a href="#org6504201">20. Guix system</a>
<ul>
<li><a href="#org59c3a93">20.1. /etc/config.scm</a></li>
<li><a href="#org096c285">20.2. /etc/signing-key.pub</a></li>
</ul>
</li>
<li><a href="#orgb6bc911">21. Custom Guix Modules</a>
<ul>
<li><a href="#orgcc63247">21.1. /etc/guix-modules/nil/packages</a>
<ul>
<li><a href="#orge1d05bc">21.1.1. brogue.scm</a></li>
<li><a href="#org818c263">21.1.2. distrobox-docker.scm</a></li>
<li><a href="#org80f1311">21.1.3. emulators.scm</a></li>
<li><a href="#org8a4284a">21.1.4. gnome.scm</a></li>
<li><a href="#org13d8471">21.1.5. steam-client.scm</a></li>
</ul>
</li>
<li><a href="#org833c9aa">21.2. /etc/guix-modules/nil/services</a>
<ul>
<li><a href="#org99cda72">21.2.1. mount-rshared.scm</a></li>
<li><a href="#orgb461ce3">21.2.2. virsh.scm</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5c16ac8">22. ZRAM on non-guix distros</a>
<ul>
<li><a href="#orgd64fcc0">22.1. /etc/modules-load.d/zram.conf</a></li>
<li><a href="#org84febd5">22.2. /etc/modprobe.d/zram.conf</a></li>
<li><a href="#org82eb147">22.3. /etc/udev/rules.d/99-zram.rules</a></li>
<li><a href="#org4810dc7">22.4. /etc/systemd/system/zram.service</a></li>
</ul>
</li>
<li><a href="#orgc4d2edd">23. Emacs</a>
<ul>
<li><a href="#org12e4c37">23.1. Initial variables</a></li>
<li><a href="#org7049b67">23.2. Packages</a></li>
<li><a href="#org8dd54aa">23.3. Extra tempel templates (.emacs.d/templates)</a></li>
<li><a href="#orgab9b427">23.4. custom-set options</a></li>
<li><a href="#orgc5c6518">23.5. Variables</a></li>
<li><a href="#org95f5589">23.6. LSP servers</a></li>
<li><a href="#org6cfc5a0">23.7. Functions</a></li>
<li><a href="#org917a9c3">23.8. Keybindings</a></li>
<li><a href="#orga29b357">23.9. .exwm.el</a></li>
</ul>
</li>
<li><a href="#org88c9411">24. Non-Guix Services and dependencies</a></li>
</ul>
</div>
</div>
<p>
<b>Click <a href="https://raw.githack.com/lambdanil/emacs-stuff/main/README.html">here</a> for a properly formatted HTML version :)</b>
</p>

<p>
<i>Debian with EXWM</i>
</p>

<div id="org1e901e4" class="figure">
<p><img src="./screenshots/exwm-scr.png" alt="exwm-scr.png" width="720px" />
</p>
</div>

<p>
<i>Debian with MATE</i>
</p>

<div id="orgdfaf1c3" class="figure">
<p><img src="./screenshots/debian-scr.png" alt="debian-scr.png" width="720px" />
</p>
</div>

<p>
<i>openSUSE Aeon with Gnome</i>
</p>

<div id="orgea0b5de" class="figure">
<p><img src="./screenshots/microos-scr.png" alt="microos-scr.png" width="720px" />
</p>
</div>

<p>
All of these are different flavors of this configuration.
</p>

<div id="outline-container-org424cb29" class="outline-2">
<h2 id="org424cb29"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is my highly modular and entirely literate full-system configuration.
</p>

<p>
Let's talk about the implementation first - how I handle it and why.
</p>
</div>

<div id="outline-container-org8d6151c" class="outline-3">
<h3 id="org8d6151c"><span class="section-number-3">1.1.</span> The why</h3>
<div class="outline-text-3" id="text-1-1">
<p>
There are multiple important ideas in place here.
</p>
</div>

<div id="outline-container-org52258f2" class="outline-4">
<h4 id="org52258f2">Reproducibility</h4>
<div class="outline-text-4" id="text-org52258f2">
<p>
I should be able to deploy this configuration quickly and easily, achieving an identical (= reasonably close to identical) result every time.
Most importantly all of the relevant dotfiles should be present and should be set up in a way that allows them to work when deployed anywhere. Every file that is relevant to reproducing this configuration should be present.
To ensure this is the case I sometimes try to set up my environment in a virtual machine so that I can check if I missed any important files.
</p>
</div>
</div>

<div id="outline-container-org9d1f4b7" class="outline-4">
<h4 id="org9d1f4b7">Separation</h4>
<div class="outline-text-4" id="text-org9d1f4b7">
<p>
The user environment should exist almost entirely separately from the system environment. 
</p>
</div>
</div>

<div id="outline-container-orgbfbac34" class="outline-4">
<h4 id="orgbfbac34">Modularity</h4>
<div class="outline-text-4" id="text-orgbfbac34">
<p>
I should be able to easily pick which parts of the configuration I want to deploy.
</p>
</div>
</div>

<div id="outline-container-org8c01428" class="outline-4">
<h4 id="org8c01428">Organization</h4>
<div class="outline-text-4" id="text-org8c01428">
<p>
There should be no confusion over how to deploy this system, nor should there be any confusion over where individual files belong, etc. All files should have their own clearly defined place.
</p>
</div>
</div>

<div id="outline-container-orgd7600e3" class="outline-4">
<h4 id="orgd7600e3">Maintainability</h4>
<div class="outline-text-4" id="text-orgd7600e3">
<p>
The configuration should be easy to keep current, it should also be robust and reliable.
</p>
</div>
</div>
</div>

<div id="outline-container-org80d10dd" class="outline-3">
<h3 id="org80d10dd"><span class="section-number-3">1.2.</span> The implementation</h3>
<div class="outline-text-3" id="text-1-2">
<p>
I'll start by outlining the structure, then I'll go over each step and explain its role.
</p>
</div>

<div id="outline-container-orga58e3ee" class="outline-4">
<h4 id="orga58e3ee">README.org</h4>
<div class="outline-text-4" id="text-orga58e3ee">
<p>
The centerpiece of this implementation is the <code>README.org</code> file. This file includes all of the plaintext dotfiles that are part of this system, as well as information about every other file.
Using <code>org</code> to describe these files allows for the configuration to remain readable and properly organized. Each chapter in this file corresponds to a single "module" (more on these below).
</p>

<p>
This <code>org</code> file is then <code>tangled</code> into the <code>configs</code> directory, where the individual files are placed into separate directories, or as I called them above, "modules".
</p>
</div>
</div>

<div id="outline-container-org659c9e4" class="outline-4">
<h4 id="org659c9e4">Modules</h4>
<div class="outline-text-4" id="text-org659c9e4">
<p>
Each module is a group of files that fulfill a certain role.
These modules should be self-reliant and shouldn't depend on other modules. In practice there are a few exceptions - for example some modules rely on the <code>guix</code> module to ship dependencies.
Non-plaintext modules are also present in the <code>configs</code> directory. These aren't tangled but are still described in the <code>org</code> file.
These are mostly things that cannot be defined in plaintext such as fonts, icons, wallpapers and similar.
</p>

<p>
All of these modules are symlinked into the home directory using GNU Stow. Using the modules in this way allows picking out specific parts of the configuration.
</p>
</div>
</div>

<div id="outline-container-org3563cff" class="outline-4">
<h4 id="org3563cff">Packages</h4>
<div class="outline-text-4" id="text-org3563cff">
<p>
The GNU Guix package manager is used for installing dependencies. This means the dependencies for this environment can be installed anywhere where Guix can run, further separating the user environment from the rest of the system and ensuring better reliability.
</p>
</div>
</div>

<div id="outline-container-org754c69b" class="outline-4">
<h4 id="org754c69b">Deployment</h4>
<div class="outline-text-4" id="text-org754c69b">
<ul class="org-ul">
<li><b>Make sure to tangle this file with <code>org-babel-tangle</code> to actually apply changes made to plaintext files</b>.</li>
<li>Install Guix and run a <code>guix pull</code> before importing Guix package manifests.</li>
<li>The guix manifest providing the bare minimum dependencies is part of the <code>guix</code> module and can be installed with <code>guix package -m $HOME/.guix-manifest-tiny</code></li>
<li>The configuration itself is placed in <code>~/git/emacs-stuff/configs</code> and <code>~/git/emacs-stuff/configs-root</code>
<ul class="org-ul">
<li><p>
From there individual modules can be installed:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006FE0;">cd</span> ./configs
<span style="color: #006DAF;">stow</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">module</span> <span style="color: #D0372D;">-t</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span>
<span style="color: #006FE0;">cd</span> ..
</pre>
</div></li>
<li><p>
Or all at once, overwriting existing:
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006FE0;">cd</span> ./configs
<span style="color: #006DAF;">stow</span> * <span style="color: #D0372D;">-t</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span> <span style="color: #D0372D;">--adopt</span>
<span style="color: #006FE0;">cd</span> ..
<span style="color: #006DAF;">git</span> reset <span style="color: #D0372D;">--hard</span>
</pre>
</div></li>
<li>The <code>configs-root</code> directory contains system environment modules. Please ensure the permissions are set correctly.
<ul class="org-ul">
<li>These files should be linked into the root filesystem (<code>/</code>) instead of <code>$HOME</code>.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ee2f26" class="outline-2">
<h2 id="org8ee2f26"><span class="section-number-2">2.</span> Autostart</h2>
<div class="outline-text-2" id="text-2">
<p>
Here I store my relevant autostart scripts.
</p>
</div>

<div id="outline-container-org6a796f3" class="outline-3">
<h3 id="org6a796f3"><span class="section-number-3">2.1.</span> .config/autostart/autostart.desktop</h3>
<div class="outline-text-3" id="text-2-1">
<p>
First we need to add a .desktop file for the DE to load.
</p>
<div class="org-src-container">
<pre class="src src-conf-desktop">[<span style="color: #6434A3;">Desktop Entry</span>] 
<span style="color: #BA36A5;">Type</span>=Application
<span style="color: #BA36A5;">Name</span>=loginctl
<span style="color: #BA36A5;">Exec</span>=/home/nil/.loginctl
<span style="color: #BA36A5;">Comment</span>=Run loginctl script on login
<span style="color: #BA36A5;">X-GNOME-Autostart-enabled</span>=<span style="color: #D0372D;">true</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org29b62a5" class="outline-3">
<h3 id="org29b62a5"><span class="section-number-3">2.2.</span> .loginctl</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Here's the actual autostart script.
</p>

<p>
For some reason Xwayland won't automatically read my Xresources, so I ensure they are read manually.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006DAF;">xrdb</span> ~/git/emacs-stuff/configs/X/.Xresources 
</pre>
</div>

<p>
I use Syncthing to sync my org agenda between different devices.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84; font-style: italic;">#syncthing serve --no-browser &amp;</span>
</pre>
</div>

<p>
Having an Emacs daemon means instant startup times for emacsclient.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84; font-style: italic;"># $HOME/.local/bin/emacs --daemon &amp;</span>
<span style="color: #006DAF;">emacs</span> <span style="color: #D0372D;">--daemon</span> &amp;
</pre>
</div>

<p>
These are only necessary when using a standalone window manager.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84; font-style: italic;"># nm-applet &amp;</span>
<span style="color: #006DAF;">blueman-applet</span> &amp;
<span style="color: #8D8D84; font-style: italic;"># xhost +si:localuser:nil</span>
<span style="color: #006DAF;">setxkbmap</span> cz <span style="color: #D0372D;">-option</span> <span style="color: #008000;">'ctrl:swapcaps'</span> &amp;
<span style="color: #8D8D84; font-style: italic;"># xinput set-prop 'pointer:Logitech G305' 'Device Accel Profile' -1 &amp;</span>
<span style="color: #8D8D84; font-style: italic;"># $HOME/.guix-profile/libexec/xdg-desktop-portal -r &amp;</span>
<span style="color: #8D8D84; font-style: italic;"># dbus-update-activation-environment --all &amp;</span>
<span style="color: #006DAF;">xinput</span> set-prop <span style="color: #008000;">'pointer:Logitech G305'</span> <span style="color: #008000;">'libinput Accel Profile Enabled'</span> 0 1 &amp;
<span style="color: #8D8D84; font-style: italic;"># /usr/bin/gnome-keyring-daemon --start --components=secrets &amp;</span>
<span style="color: #006DAF;">playerctld</span> &amp;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org601d709" class="outline-2">
<h2 id="org601d709"><span class="section-number-2">3.</span> Bash</h2>
<div class="outline-text-2" id="text-3">
<p>
Let's move on to configuring the shell - bash in my case.
</p>
</div>

<div id="outline-container-org202e160" class="outline-3">
<h3 id="org202e160"><span class="section-number-3">3.1.</span> .bashrc</h3>
<div class="outline-text-3" id="text-3-1">
<p>
I like to have a function to clear old guix builds by regex, helps keep the amount of garbage down.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006699;">clean_build</span> <span style="color: #707183;">()</span> <span style="color: #707183;">{</span> <span style="color: #8D8D84; font-style: italic;"># clear guix build by regex</span>
    <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">[</span><span style="color: #909183;">[</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">1</span> <span style="color: #909183;">]</span><span style="color: #7388D6;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
        <span style="color: #BA36A5; font-style: italic;">CLEAR_BUILD_PATHS</span>=<span style="color: #008000;">"</span><span style="color: #008000;">$(</span><span style="color: #006DAF; background-color: #FFFFFF;">ls</span><span style="color: #008000; background-color: #FFFFFF;"> </span><span style="color: #808080; background-color: #FFFFFF; font-weight: bold;">--color=never</span><span style="color: #008000; background-color: #FFFFFF;"> </span><span style="color: #D0372D; background-color: #FFFFFF;">-d</span><span style="color: #008000; background-color: #FFFFFF;"> /gnu/store/</span><span style="color: #0000FF; background-color: #FFFFFF;">$</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">1</span><span style="color: #008000; background-color: #FFFFFF;"> </span><span style="color: #0000FF; background-color: #FFFFFF;">|</span><span style="color: #008000; background-color: #FFFFFF;"> </span><span style="color: #006DAF; background-color: #FFFFFF;">tr</span><span style="color: #008000; background-color: #FFFFFF;"> '\n' ' '</span><span style="color: #008000;">)</span><span style="color: #008000;">"</span>
    <span style="color: #0000FF;">else</span>
        <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"no regex specified"</span>
        <span style="color: #006DAF;">return</span> 1
    <span style="color: #0000FF;">fi</span>
    <span style="color: #0000FF;">if</span> <span style="color: #7388D6;">[</span><span style="color: #909183;">[</span> <span style="color: #0000FF;">$</span><span style="color: #709870;">(</span><span style="color: #006FE0; background-color: #FFFFFF;">echo</span><span style="color: #333333; background-color: #FFFFFF;"> </span><span style="color: #008000; background-color: #FFFFFF;">"</span><span style="color: #0000FF; background-color: #FFFFFF;">$</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">CLEAR_BUILD_PATHS</span><span style="color: #008000; background-color: #FFFFFF;">"</span><span style="color: #333333; background-color: #FFFFFF;"> </span><span style="color: #0000FF; background-color: #FFFFFF;">|</span><span style="color: #333333; background-color: #FFFFFF;"> </span><span style="color: #006DAF; background-color: #FFFFFF;">wc</span><span style="color: #333333; background-color: #FFFFFF;"> </span><span style="color: #D0372D; background-color: #FFFFFF;">-c</span><span style="color: #709870;">)</span> -ne 1 <span style="color: #909183;">]</span><span style="color: #7388D6;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
        <span style="color: #006DAF;">guix</span> gc <span style="color: #D0372D;">--delete</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">CLEAR_BUILD_PATHS</span>
    <span style="color: #0000FF;">else</span>
        <span style="color: #006FE0;">echo</span> <span style="color: #008000;">"no match for regex found"</span>
        <span style="color: #006DAF;">return</span> 1
    <span style="color: #0000FF;">fi</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
A small bit used to remind me when I'm inside a Guix environment.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span> -n <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">GUIX_ENVIRONMENT</span><span style="color: #008000;">"</span> <span style="color: #707183;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
    <span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span><span style="color: #7388D6;">[</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">PS1</span> =~ <span style="color: #909183;">(</span>.*<span style="color: #909183;">)</span>"\\$" <span style="color: #7388D6;">]</span><span style="color: #707183;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
        <span style="color: #BA36A5; font-style: italic;">PS1</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">${</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">BASH_REMATCH</span><span style="color: #333333; background-color: #FFFFFF;">[1]</span><span style="color: #0000FF;">}</span><span style="color: #008000;"> [env]\\\$ "</span>
    <span style="color: #0000FF;">fi</span>
<span style="color: #0000FF;">fi</span>
</pre>
</div>

<p>
Set up the prompt with fancy colors and a cute lambda.
In case <code>tput</code> (part of <code>ncurses</code>) isn't available an alternative is provided.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span><span style="color: #7388D6;">[</span> <span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold;">-</span> <span style="color: #0000FF;">==</span> *i* <span style="color: #7388D6;">]</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">then</span>
    <span style="color: #BA36A5; font-style: italic;">_GREEN</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> setaf 2</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_MAGENTA</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> setaf 207</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_BLUE</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> setaf 4</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_RED</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> setaf 1</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_CYAN</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> setaf 45</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_RESET</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> sgr0</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5; font-style: italic;">_BOLD</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">tput</span><span style="color: #333333; background-color: #FFFFFF;"> bold</span><span style="color: #707183;">)</span>
    <span style="color: #8D8D84; font-style: italic;"># _GREEN="\e[0;32m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _MAGENTA="\e[0;35m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _BLUE="\e[0;34m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _RED="\e[0;31m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _CYAN="\e[0;36m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _RESET="\e[0m"</span>
    <span style="color: #8D8D84; font-style: italic;"># _BOLD="\e[1m"</span>
    <span style="color: #8D8D84; font-style: italic;">#  export LD_LIBRARY_PATH=$LIBRARY_PATH</span>
    <span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">PS1</span>=<span style="color: #008000;">"[</span><span style="color: #0000FF;">${</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">_MAGENTA</span><span style="color: #0000FF;">}</span><span style="color: #008000;">\u</span><span style="color: #0000FF;">${</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">_RESET</span><span style="color: #0000FF;">}</span><span style="color: #008000;">@</span><span style="color: #0000FF;">${</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">_CYAN</span><span style="color: #0000FF;">}</span><span style="color: #008000;">\h</span><span style="color: #0000FF;">${</span><span style="color: #D0372D; background-color: #FFFFFF; font-style: italic;">_RESET</span><span style="color: #0000FF;">}</span><span style="color: #008000;">] \t\n(\w) &#955; "</span>
<span style="color: #0000FF;">fi</span>
</pre>
</div>

<p>
Guix needs to be separately sourced in non-container interactive shells.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span> ! -f /.dockerenv <span style="color: #707183;">]</span> <span style="color: #0000FF;">&amp;&amp;</span> <span style="color: #707183;">[</span> ! -f /run/.containerenv <span style="color: #707183;">]</span> <span style="color: #0000FF;">&amp;&amp;</span> <span style="color: #707183;">[</span> -d <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile"</span> <span style="color: #707183;">]</span> <span style="color: #0000FF;">&amp;&amp;</span> <span style="color: #707183;">[</span><span style="color: #7388D6;">[</span> <span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold;">-</span> <span style="color: #0000FF;">==</span> *i* <span style="color: #7388D6;">]</span><span style="color: #707183;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
    <span style="color: #BA36A5; font-style: italic;">GUIX_PROFILE</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile"</span>
    <span style="color: #006DAF;">.</span> <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">GUIX_PROFILE</span><span style="color: #008000;">/etc/profile"</span>
    <span style="color: #BA36A5; font-style: italic;">GUIX_PROFILE</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.config/guix/current"</span>
    <span style="color: #006DAF;">.</span> <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">GUIX_PROFILE</span><span style="color: #008000;">/etc/profile"</span>
<span style="color: #0000FF;">fi</span>
</pre>
</div>

<p>
Add some aliases.
The <code>ld_libs</code> is useful for exporting Guix's libraries to run precompiled software.
</p>
<div class="org-src-container">
<pre class="src src-bash">  <span style="color: #006FE0;">alias</span> sudo=<span style="color: #008000;">"sudo -p \"[sudo] what's youw p-pa-password, Nil-chan?~ &#10084;&#65039;  \" "</span>
<span style="color: #8D8D84; font-style: italic;">#  alias apt="nala"</span>
  <span style="color: #006FE0;">alias</span> ls=<span style="color: #008000;">"ls --color"</span>
  <span style="color: #006FE0;">alias</span> ld_libs=<span style="color: #008000;">"export LD_LIBRARY_PATH=\$LIBRARY_PATH"</span>
  <span style="color: #006FE0;">alias</span> tf=<span style="color: #008000;">"xrandr --output HDMI-A-1 --set TearFree"</span>
  <span style="color: #006FE0;">alias</span> hyfetch=<span style="color: #008000;">"hyfetch --ascii-file ~/git/neofetch-logo"</span>
  <span style="color: #006FE0;">alias</span> deb=<span style="color: #008000;">"xhost +si:localuser:nil &amp;&amp; distrobox enter debian --"</span>
  <span style="color: #006FE0;">alias</span> glibc=<span style="color: #008000;">"bwrap --bind /var/chroots/debian / --dev /dev --proc /proc --bind /sys /sys  --ro-bind /sys/dev/char /sys/dev/char --ro-bind /sys/devices/pci0000:00 /sys/devices/pci0000:00 --bind /run /run --bind /home /home --ro-bind /dev/dri /dev/dri --ro-bind /etc/resolv.conf /etc/resolv.conf --ro-bind /etc/passwd /etc/passwd --ro-bind /etc/group /etc/group"</span>
  <span style="color: #006FE0;">alias</span> glibc-root=<span style="color: #008000;">"doas chroot /var/chroots/debian /bin/bash"</span>
</pre>
</div>

<p>
Finally some variable exports - for Guix and Flatpak and a silly <code>sudo</code> prompt.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">XDG_DATA_DIRS</span>=<span style="color: #008000;">"/var/lib/flatpak/exports/share:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.local/share/flatpak/exports/share:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">XDG_DATA_DIRS</span><span style="color: #008000;">"</span>
<span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">GUIX_PACKAGE_PATH</span>=<span style="color: #008000;">"/etc/guix-modules"</span>
<span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">SUDO_PROMPT</span>=<span style="color: #008000;">'[sudo] what'</span>\'<span style="color: #008000;">'s youw p-pa-password, Nil-chan?~ &#10084;&#65039;  '</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ea9f14" class="outline-3">
<h3 id="org5ea9f14"><span class="section-number-3">3.2.</span> .bash profile</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Let's move onto the bash profile, used in login shells.
</p>

<p>
First run the bashrc if necessary.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #8D8D84; font-style: italic;"># Honor per-interactive-shell startup file</span>
<span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span> -f ~/.bashrc <span style="color: #707183;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span> <span style="color: #006DAF;">.</span> ~/.bashrc<span style="color: #0000FF;">;</span> <span style="color: #0000FF;">fi</span>
<span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">LANG</span>=cs_CZ.utf-8
<span style="color: #0000FF;">export</span> <span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span>=<span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span>:$HOME/.local/bin:<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span>/.bin:$HOME/.py/bin:/usr/lib/go-1.21/bin
</pre>
</div>

<p>
Then we can go ahead and export Guix, but only when not inside a container. I also verify the Guix profile exists before trying to load it.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span> ! -f /.dockerenv <span style="color: #707183;">]</span> <span style="color: #0000FF;">&amp;&amp;</span> <span style="color: #707183;">[</span> ! -f /run/.containerenv <span style="color: #707183;">]</span> <span style="color: #0000FF;">&amp;&amp;</span> <span style="color: #707183;">[</span> -d <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile"</span> <span style="color: #707183;">]</span><span style="color: #0000FF;">;</span> <span style="color: #0000FF;">then</span>
    <span style="color: #8D8D84; font-style: italic;"># source "$HOME/.guix-profile/etc/profile"</span>
    <span style="color: #8D8D84; font-style: italic;"># source "$HOME/.config/guix/current/etc/profile"</span>
    <span style="color: #0000FF;">export</span> <span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span><span style="color: #008000;">:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile/bin"</span>
    <span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">XDG_DATA_DIRS</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">XDG_DATA_DIRS</span><span style="color: #008000;">:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile/share"</span>
    <span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">GUIX_LOCPATH</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile/lib/locale"</span>
<span style="color: #0000FF;">fi</span>
</pre>
</div>

<p>
This makes sway start up automatically when logging into <code>tty2</code>, eliminating the need for a login manager.
</p>
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000FF;">if</span> <span style="color: #707183;">[</span><span style="color: #7388D6;">[</span> <span style="color: #008000;">"</span><span style="color: #008000;">$(</span><span style="color: #006DAF; background-color: #FFFFFF;">tty</span><span style="color: #008000;">)</span><span style="color: #008000;">"</span> <span style="color: #0000FF;">==</span> <span style="color: #008000;">"/dev/tty2"</span> <span style="color: #7388D6;">]</span><span style="color: #707183;">]</span>
<span style="color: #0000FF;">then</span>
    <span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">XDG_CURRENT_DESKTOP</span>=sway
    <span style="color: #006DAF;">exec</span> dbus-run-session <span style="color: #D0372D;">--</span> sway
<span style="color: #0000FF;">fi</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1419738" class="outline-2">
<h2 id="org1419738"><span class="section-number-2">4.</span> Custom Binaries</h2>
<div class="outline-text-2" id="text-4">
<p>
Here I have some custom binaries, mostly scripts and stuff.
</p>
</div>

<div id="outline-container-orgbf4fa58" class="outline-3">
<h3 id="orgbf4fa58"><span class="section-number-3">4.1.</span> .bin/scr</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Just a screenshot shortcut.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #006DAF;">grim</span> <span style="color: #D0372D;">-</span> <span style="color: #0000FF;">|</span> <span style="color: #006DAF;">wl-copy</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfafe2d4" class="outline-3">
<h3 id="orgfafe2d4"><span class="section-number-3">4.2.</span> .bin/scr-area</h3>
<div class="outline-text-3" id="text-4-2">
<p>
&#x2026;And the same but for a selected area.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #006DAF;">grim</span> <span style="color: #D0372D;">-g</span> <span style="color: #008000;">"</span><span style="color: #008000;">$(</span><span style="color: #006DAF; background-color: #FFFFFF;">slurp</span><span style="color: #008000;">)</span><span style="color: #008000;">"</span> <span style="color: #D0372D;">-</span> <span style="color: #0000FF;">|</span> <span style="color: #006DAF;">wl-copy</span>   
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd008264" class="outline-3">
<h3 id="orgd008264"><span class="section-number-3">4.3.</span> .bin/chromium-incognito</h3>
<div class="outline-text-3" id="text-4-3">
<p>
And a shortcut for opening chromium in incognito mode.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #006DAF;">chromium</span> <span style="color: #D0372D;">--incognito</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2c1065a" class="outline-2">
<h2 id="org2c1065a"><span class="section-number-2">5.</span> Containers</h2>
<div class="outline-text-2" id="text-5">
<p>
I use distrobox docker/podman (depending on which is available, podman is prefered) on my installation.
Here is some necessary configs for the containers.
</p>
</div>

<div id="outline-container-orgeb7babd" class="outline-3">
<h3 id="orgeb7babd"><span class="section-number-3">5.1.</span> .config/containers/policy.json</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This isn't super secure.
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #707183; background-color: #FFFFFF;">{</span>
    <span style="color: #0000FF;">"default"</span>: <span style="color: #7388D6; background-color: #FFFFFF;">[</span>
        <span style="color: #909183; background-color: #FFFFFF;">{</span>
        <span style="color: #0000FF;">"type"</span>: <span style="color: #008000;">"insecureAcceptAnything"</span>
    <span style="color: #909183; background-color: #FFFFFF;">}</span>
    <span style="color: #7388D6; background-color: #FFFFFF;">]</span>,
    <span style="color: #0000FF;">"transports"</span>:
    <span style="color: #7388D6; background-color: #FFFFFF;">{</span>
        <span style="color: #0000FF;">"docker-daemon"</span>:
        <span style="color: #909183; background-color: #FFFFFF;">{</span>
            <span style="color: #0000FF;">""</span>: <span style="color: #709870; background-color: #FFFFFF;">[</span><span style="color: #907373; background-color: #FFFFFF;">{</span><span style="color: #0000FF;">"type"</span>:<span style="color: #008000;">"insecureAcceptAnything"</span><span style="color: #907373; background-color: #FFFFFF;">}</span><span style="color: #709870; background-color: #FFFFFF;">]</span>
        <span style="color: #909183; background-color: #FFFFFF;">}</span>
    <span style="color: #7388D6; background-color: #FFFFFF;">}</span>
<span style="color: #707183; background-color: #FFFFFF;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb09b3e6" class="outline-3">
<h3 id="orgb09b3e6"><span class="section-number-3">5.2.</span> .config/containers/registries.conf</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Add the necessary registries.
</p>
<div class="org-src-container">
<pre class="src src-conf-unix"><span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">Copied from https://raw.githubusercontent.com/projectatomic/registries/master/registries.fedora</span>
[<span style="color: #6434A3;">registries.search</span>]
<span style="color: #BA36A5;">registries</span> = [<span style="color: #008000;">'docker.io'</span>, <span style="color: #008000;">'registry.fedoraproject.org'</span>, <span style="color: #008000;">'registry.access.redhat.com'</span>]

[<span style="color: #6434A3;">registries.insecure</span>]
<span style="color: #BA36A5;">registries</span> = []

<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">Docker only</span>
[<span style="color: #6434A3;">registries.block</span>]
<span style="color: #BA36A5;">registries</span> = []
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6020da8" class="outline-2">
<h2 id="org6020da8"><span class="section-number-2">6.</span> Dictionaries</h2>
<div class="outline-text-2" id="text-6">
<p>
This module provides the Czech hunspell dictionary since it currently isn't available in Guix.
The files were taken from the <a href="https://github.com/LibreOffice/dictionaries">LibreOffice dictionaries repository</a>.
</p>
</div>
</div>

<div id="outline-container-org8148c21" class="outline-2">
<h2 id="org8148c21"><span class="section-number-2">7.</span> Debian Dependencies</h2>
<div class="outline-text-2" id="text-7">
<p>
My long distrohopping journey has eventually landed me on Debian, which is the system I choose to run nowadays.
In order to simplify deploying my configuration on new Debian installations I've decided to add a simple list of <code>apt</code>-installable dependencies.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006DAF;">sudo</span> apt install xinput git stow gcc sbcl guile-3.0 libtool-bin clang cmake make libenchant-2-dev
</pre>
</div>

<p>
Emacs is installed separately from the backports.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #006DAF;">sudo</span> apt install emacs <span style="color: #D0372D;">-t</span> bookworm-backports
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec1aae8" class="outline-2">
<h2 id="orgec1aae8"><span class="section-number-2">8.</span> Firefox</h2>
<div class="outline-text-2" id="text-8">
<p>
This module provides my Firefox configuration. For tree style tab it's necessary to import <code>$HOME/.mozilla/firefox/default/treestyletab.css</code>.
</p>
</div>
</div>

<div id="outline-container-org4821721" class="outline-2">
<h2 id="org4821721"><span class="section-number-2">9.</span> Fonts</h2>
<div class="outline-text-2" id="text-9">
<p>
This module provides the necessary fonts.
</p>
</div>
</div>

<div id="outline-container-org6dee77c" class="outline-2">
<h2 id="org6dee77c"><span class="section-number-2">10.</span> Gtk</h2>
<div class="outline-text-2" id="text-10">
<p>
This module provides straightforward GTK3 configuration.
</p>
<div class="org-src-container">
<pre class="src src-conf-unix">[<span style="color: #6434A3;">Settings</span>]
<span style="color: #BA36A5;">gtk-cursor-theme-name</span>=Simp1e-Adw
<span style="color: #BA36A5;">gtk-icon-theme-name</span>=Papirus-Dark
<span style="color: #BA36A5;">gtk-theme-name</span>=Dracula
<span style="color: #BA36A5;">gtk-font-name</span>=Noto Sans 10
<span style="color: #BA36A5;">gtk-application-prefer-dark-theme</span>=1
</pre>
</div>

<p>
This adds a bit of padding to the XFCE terminal.
</p>
<div class="org-src-container">
<pre class="src src-css"><span style="color: #006FE0;">VteTerminal</span><span style="color: #333333; background-color: #FFFFFF;">,</span> <span style="color: #006FE0;">vte-terminal</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">padding</span>: <span style="color: #D0372D;">8</span><span style="color: #6434A3;">px</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bf02e2" class="outline-2">
<h2 id="org4bf02e2"><span class="section-number-2">11.</span> Guix</h2>
<div class="outline-text-2" id="text-11">
<p>
<b>This module depends on the <code>guix-modules</code> module for certain package definitions!</b>
GNU Guix is a very important part of my configuration.
</p>
</div>

<div id="outline-container-org48b7506" class="outline-3">
<h3 id="org48b7506"><span class="section-number-3">11.1.</span> .guix-manifest</h3>
<div class="outline-text-3" id="text-11-1">
<p>
Just a straightforward (and very messy!) package manifest. I have decided to keep this as a separate file rather than tangle it. This allows me to use <code>guix package --export-manifest</code> to update it.
</p>
</div>
</div>

<div id="outline-container-org3b5d902" class="outline-3">
<h3 id="org3b5d902"><span class="section-number-3">11.2.</span> .guix-manifest-tiny</h3>
<div class="outline-text-3" id="text-11-2">
<p>
Due to the above manifest becoming rather bloated a minimal replacement is provided here. This includes only the necessary dependencies to get the system running correctly.
</p>

<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>specifications-&gt;manifest
 <span style="color: #7388D6;">(</span>list <span style="color: #008000;">"glibc-locales"</span>
       <span style="color: #008000;">"gcc"</span>
       <span style="color: #008000;">"syncthing"</span>
       <span style="color: #008000;">"sbcl"</span>
       <span style="color: #008000;">"guile"</span>
       <span style="color: #008000;">"cmake"</span>
       <span style="color: #008000;">"make"</span>
       <span style="color: #008000;">"emacs"</span>
       <span style="color: #008000;">"hunspell-dict-en-us"</span>
       <span style="color: #008000;">"enchant"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0be4001" class="outline-3">
<h3 id="org0be4001"><span class="section-number-3">11.3.</span> .config/guix/channels.scm</h3>
<div class="outline-text-3" id="text-11-3">
<p>
Here is the setup for channels, only real addition here is <code>nonguix</code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">use-modules</span> <span style="color: #7388D6;">(</span>guix ci<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>cons* <span style="color: #7388D6;">(</span>channel-with-substitutes-available
        %default-guix-channel
        <span style="color: #008000;">"https://ci.guix.gnu.org"</span><span style="color: #7388D6;">)</span>
       <span style="color: #7388D6;">(</span>channel
        <span style="color: #909183;">(</span>name 'nonguix<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span>url <span style="color: #008000;">"https://gitlab.com/nonguix/nonguix"</span><span style="color: #909183;">)</span>
        <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Enable signature verification:</span>
        <span style="color: #909183;">(</span>introduction
         <span style="color: #709870;">(</span>make-channel-introduction
          <span style="color: #008000;">"897c1a470da759236cc11798f4e0a5f7d4d59fbc"</span>
          <span style="color: #907373;">(</span>openpgp-fingerprint
           <span style="color: #008000;">"2A39 3FFF 68F4 EF7A 3D29  12AF 6F51 20A0 22FB B2D5"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
       %default-channels<span style="color: #707183;">)</span>

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org53f849c" class="outline-2">
<h2 id="org53f849c"><span class="section-number-2">12.</span> Guix-run</h2>
<div class="outline-text-2" id="text-12">
<p>
<code>guix-run</code> is a tiny script I originally found on Github. Unfortunately I do not have the original link anymore.
</p>
</div>

<div id="outline-container-org2b1965c" class="outline-3">
<h3 id="org2b1965c"><span class="section-number-3">12.1.</span> .bin/guix-run</h3>
<div class="outline-text-3" id="text-12-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">LD_LIBRARY_PATH</span>=<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">LIBRARY_PATH</span>
<span style="color: #BA36A5; font-style: italic;">RUNNER</span>=<span style="color: #0000FF;">$</span><span style="color: #707183;">(</span><span style="color: #006DAF; background-color: #FFFFFF;">find</span><span style="color: #333333; background-color: #FFFFFF;"> ~/.guix-profile/lib/ </span><span style="color: #D0372D; background-color: #FFFFFF;">-name</span><span style="color: #333333; background-color: #FFFFFF;"> </span><span style="color: #008000; background-color: #FFFFFF;">'ld-linux-*.so*'</span><span style="color: #707183;">)</span>

<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">RUNNER</span> <span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold;">@</span><span style="color: #008000;">"</span> <span style="color: #8D8D84; font-style: italic;">#!/bin/sh</span>

<span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">LD_LIBRARY_PATH</span>=<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">LIBRARY_PATH</span>
<span style="color: #006DAF;">RUNNER</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org056fb13" class="outline-2">
<h2 id="org056fb13"><span class="section-number-2">13.</span> Sway</h2>
<div class="outline-text-2" id="text-13">
<p>
<code>Sway</code> is one of the window managers I have a full setup for. While I do usually prefer to use a DE or EXWM, I do have sway here for completeness.
</p>
</div>

<div id="outline-container-orge6db0ea" class="outline-3">
<h3 id="orge6db0ea"><span class="section-number-3">13.1.</span> .config/sway/config</h3>
<div class="outline-text-3" id="text-13-1">
<p>
Set some initial variables first.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">set</span> $mod Mod4
<span style="color: #BA36A5;">set</span> $HOME /home/nil
<span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">set $term emacsclient -c -e "(let ((current-prefix-arg '(4))) (call-interactively 'vterm))"</span>
<span style="color: #BA36A5;">set</span> $term xfce4-terminal
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">set $files emacsclient -c -e '(dired "~")'</span>
<span style="color: #BA36A5;">set</span> $files thunar
<span style="color: #BA36A5;">set</span> $wallpaper $HOME/.local/share/wallpapers/deijurj-adfa3118-4bd6-4350-b9db-43d4d835536c.jpg
<span style="color: #BA36A5;">set</span> $lock swaylock -i $wallpaper
<span style="color: #BA36A5;">set</span> $scr_off swaymsg <span style="color: #008000;">"output * dpms off"</span>
<span style="color: #BA36A5;">set</span> $scr_on swaymsg <span style="color: #008000;">"output * dpms on"</span>
<span style="color: #BA36A5;">font</span> pango:Fira Code 9
<span style="color: #BA36A5;">gaps</span> inner 8px
<span style="color: #BA36A5;">for_window</span> [class=<span style="color: #008000;">"^.*"</span>] border pixel 2
<span style="color: #BA36A5;">floating_modifier</span> $mod
<span style="color: #BA36A5;">seat</span> seat0 xcursor_theme Breeze_Snow
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">tiling_drag modifier titlebar</span>
</pre>
</div>

<p>
Configure input.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #6434A3;">input *</span> {
<span style="color: #BA36A5;">xkb_layout</span> <span style="color: #008000;">"cz"</span>
<span style="color: #BA36A5;">xkb_options</span> <span style="color: #008000;">"ctrl:swapcaps"</span>
<span style="color: #BA36A5;">accel_profile</span> flat
<span style="color: #BA36A5;">xkb_numlock</span> enabled
<span style="color: #BA36A5;">}</span>
</pre>
</div>

<p>
Window rules for transparency, etc.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">for_window</span> [app_id=<span style="color: #008000;">"thunar"</span>] opacity 0.96
</pre>
</div>

<p>
I decrease the time to render a frame as much as possible (12ms in this case), this significantly helps eliminate input lag. This value needs to be increased if stuttering becomes an issue.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">output</span> HDMI-A-2 max_render_time 12
<span style="color: #BA36A5;">output</span> HDMI-A-1 disable
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">swaymsg -t get_outputs</span>
</pre>
</div>

<p>
Execute the startup environment, this is necessary for XDG autostart files.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">exec</span> dbus-update-activation-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK
<span style="color: #BA36A5;">exec</span> --no-startup-id $HOME/.loginctl
<span style="color: #BA36A5;">exec</span> --no-startup-id swaybg -i $wallpaper
<span style="color: #BA36A5;">exec</span> --no-startup-id gsettings set org.gnome.desktop.interface gtk-theme Dracula
<span style="color: #BA36A5;">exec</span> --no-startup-id gsettings set org.gnome.desktop.interface icon-theme Papirus-Dark
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">exec /usr/libexec/polkit-gnome-authentication-agent-1</span>
</pre>
</div>

<p>
Configure <code>swaylock</code> to start automatically.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">exec</span> --no-startup-id swayidle timeout 480 <span style="color: #008000;">'$lock'</span> timeout 600 <span style="color: #008000;">'$scr_off'</span> resume <span style="color: #008000;">'$scr_on'</span>
</pre>
</div>

<p>
Now assigning some keybindings; all of these are rather self-explanatory.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">set</span> $refresh_i3status killall -SIGUSR1 i3status
<span style="color: #BA36A5;">bindsym</span> XF86AudioRaiseVolume exec --no-startup-id pamixer -i 10
<span style="color: #BA36A5;">bindsym</span> XF86AudioLowerVolume exec --no-startup-id pamixer -d 10
<span style="color: #BA36A5;">bindsym</span> XF86AudioMute exec --no-startup-id pamixer -t
<span style="color: #BA36A5;">bindsym</span> XF86AudioMicMute exec --no-startup-id pactl set-source-mute @DEFAULT_SOURCE@ toggle
<span style="color: #BA36A5;">bindsym</span> Print exec --no-startup-id $HOME/.bin/scr
<span style="color: #BA36A5;">bindsym</span> Shift+Print exec --no-startup-id $HOME/.bin/scr-area

<span style="color: #BA36A5;">bindsym</span> $mod+Return exec $term
<span style="color: #BA36A5;">bindsym</span> $mod+q kill

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Control+l exec --no-startup-id $lock

<span style="color: #BA36A5;">bindsym</span> $mod+d exec --no-startup-id rofi -theme ~/.config/wofi/nord.rasi -show drun
<span style="color: #BA36A5;">bindsym</span> $mod+b exec --no-startup-id rofi -theme ~/.config/wofi/nord.rasi -show window

<span style="color: #BA36A5;">bindsym</span> $mod+e exec --no-startup-id emacsclient -c
<span style="color: #BA36A5;">bindsym</span> $mod+a exec --no-startup-id $files      
</pre>
</div>

<p>
Window focus:
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">bindsym</span> $mod+h focus left
<span style="color: #BA36A5;">bindsym</span> $mod+j focus down
<span style="color: #BA36A5;">bindsym</span> $mod+k focus up
<span style="color: #BA36A5;">bindsym</span> $mod+l focus right
<span style="color: #BA36A5;">bindsym</span> Mod1+Tab focus right
<span style="color: #BA36A5;">bindsym</span> Mod1+Shift+Tab focus left
<span style="color: #BA36A5;">bindsym</span> $mod+Left focus left
<span style="color: #BA36A5;">bindsym</span> $mod+Down focus down
<span style="color: #BA36A5;">bindsym</span> $mod+Up focus up
<span style="color: #BA36A5;">bindsym</span> $mod+Right focus right
</pre>
</div>

<p>
Moving and resizing windows:
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">bindsym</span> $mod+m sticky toggle

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+h move left
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+j move down
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+k move up
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+l move right

<span style="color: #BA36A5;">bindsym</span> $mod+Tab move right
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Tab move left

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Left move left
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Down move down
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Up move up
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+Right move right

<span style="color: #BA36A5;">bindsym</span> $mod+Control+h resize shrink width 2 px or 2 ppt
<span style="color: #BA36A5;">bindsym</span> $mod+Control+j resize grow height 2 px or 2 ppt
<span style="color: #BA36A5;">bindsym</span> $mod+Control+k resize shrink height 2 px or 2 ppt
<span style="color: #BA36A5;">bindsym</span> $mod+Control+l resize grow width 2 px or 2 ppt
</pre>
</div>

<p>
Splitting and layouts:
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">bindsym</span> $mod+v split h

<span style="color: #BA36A5;">bindsym</span> $mod+c split v

<span style="color: #BA36A5;">bindsym</span> $mod+s split toggle

<span style="color: #BA36A5;">bindsym</span> $mod+f fullscreen toggle

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+s layout stacking
<span style="color: #BA36A5;">bindsym</span> $mod+w layout tabbed
<span style="color: #BA36A5;">bindsym</span> $mod+y layout toggle split

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+space floating toggle

<span style="color: #BA36A5;">bindsym</span> $mod+space focus mode_toggle

<span style="color: #BA36A5;">bindsym</span> $mod+Shift+x focus parent

<span style="color: #BA36A5;">bindsym</span> $mod+x focus child
</pre>
</div>

<p>
Next set some workspace names and bindings.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">set</span> $ws1 <span style="color: #008000;">"1:&#955;"</span>
<span style="color: #BA36A5;">set</span> $ws2 <span style="color: #008000;">"2:&#945;"</span>
<span style="color: #BA36A5;">set</span> $ws3 <span style="color: #008000;">"3:&#946;"</span>
<span style="color: #BA36A5;">set</span> $ws4 <span style="color: #008000;">"4:&#947;"</span>
<span style="color: #BA36A5;">set</span> $ws5 <span style="color: #008000;">"5:&#948;"</span>
<span style="color: #BA36A5;">set</span> $ws6 <span style="color: #008000;">"6:&#949;"</span>
<span style="color: #BA36A5;">set</span> $ws7 <span style="color: #008000;">"7:&#950;"</span>
<span style="color: #BA36A5;">set</span> $ws8 <span style="color: #008000;">"8:&#951;"</span>
<span style="color: #BA36A5;">set</span> $ws9 <span style="color: #008000;">"9:&#952;"</span>
<span style="color: #BA36A5;">set</span> $ws10 <span style="color: #008000;">"10:&#953;"</span>

<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">switch to workspace</span>
<span style="color: #BA36A5;">bindsym</span> $mod+plus workspace $ws1
<span style="color: #BA36A5;">bindsym</span> $mod+ecaron workspace $ws2
<span style="color: #BA36A5;">bindsym</span> $mod+scaron workspace $ws3
<span style="color: #BA36A5;">bindsym</span> $mod+ccaron workspace $ws4
<span style="color: #BA36A5;">bindsym</span> $mod+rcaron workspace $ws5
<span style="color: #BA36A5;">bindsym</span> $mod+zcaron workspace $ws6
<span style="color: #BA36A5;">bindsym</span> $mod+yacute workspace $ws7
<span style="color: #BA36A5;">bindsym</span> $mod+aacute workspace $ws8
<span style="color: #BA36A5;">bindsym</span> $mod+iacute workspace $ws9
<span style="color: #BA36A5;">bindsym</span> $mod+eacute workspace $ws10

<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">move focused container to workspace</span>
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+plus move container to workspace $ws1
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+ecaron move container to workspace $ws2
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+scaron move container to workspace $ws3
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+ccaron move container to workspace $ws4
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+rcaron move container to workspace $ws5
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+zcaron move container to workspace $ws6
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+yacute move container to workspace $ws7
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+aacute move container to workspace $ws8
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+iacute move container to workspace $ws9
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+eacute move container to workspace $ws10  
</pre>
</div>

<p>
Now for session commands:
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">bindsym</span> $mod+Shift+r reload
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">restart sway inplace (preserves your layout/session, can be used to upgrade sway)</span>
  <span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">leftover from i3, not supported by sway!</span>
  <span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">bindsym $mod+Control+r restart</span>
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">exit sway (logs you out of your Wayland session)</span>
<span style="color: #BA36A5;">bindsym</span> $mod+Shift+e exec <span style="color: #008000;">"swaynag -t warning -m 'You pressed the exit shortcut. Do you really want to exit sway? This will end your Wayland session.' -B 'Yes, exit sway' 'swaymsg exit'"</span>
</pre>
</div>

<p>
Handle colors next; following the Nord colorscheme here.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">set</span> $bg-color      <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">b19cd8</span>
<span style="color: #BA36A5;">set</span> $active-border-color <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">FFFFFF</span>
<span style="color: #BA36A5;">set</span> $inactive-bg-color   <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">2E3440</span>
<span style="color: #BA36A5;">set</span> $text-color          <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">f5f5f5</span>
<span style="color: #BA36A5;">set</span> $inactive-text-color <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">d8dee9</span>
<span style="color: #BA36A5;">set</span> $urgent-bg-color     <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">A7C7E7</span>

<span style="color: #BA36A5;">client.focused</span>          $bg-color           $bg-color          $inactive-bg-color          $active-border-color
<span style="color: #8D8D84; font-style: italic;"># </span><span style="color: #8D8D84; font-style: italic;">nice transparent borders for unfocused windows :3               </span>
<span style="color: #BA36A5;">client.unfocused</span>        $inactive-bg-color  $inactive-bg-color  $inactive-text-color $inactive-bg-color <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">00000000</span>
<span style="color: #BA36A5;">client.focused_inactive</span> $inactive-bg-color $inactive-bg-color $inactive-text-color $inactive-bg-color
<span style="color: #BA36A5;">client.urgent</span>           $urgent-bg-color    $urgent-bg-color   $text-color          $urgent-bg-color


<span style="color: #BA36A5;">client.background</span>       <span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">2B2C2B</span>
</pre>
</div>

<p>
Configure the sway bar.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #6434A3;">bar</span> {
<span style="color: #8D8D84; font-style: italic;">#</span><span style="color: #8D8D84; font-style: italic;">strip_workspace_numbers yes</span>
<span style="color: #BA36A5;">position</span> top
<span style="color: #BA36A5;">mode</span> dock
<span style="color: #BA36A5;">status_padding</span> 4
<span style="color: #BA36A5;">tray_padding</span> 4
</pre>
</div>

<p>
I pipe the status command through a wrapper, which makes extra modifications to the output.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">status_command</span> i3status | ~/.config/sway/i3status_wrapper.py
</pre>
</div>

<p>
And finally set colors.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #6434A3;">colors</span> {
<span style="color: #BA36A5;">background</span> $inactive-bg-color
<span style="color: #BA36A5;">separator</span> $inactive-bg-color
<span style="color: #8D8D84; font-style: italic;">#                  </span><span style="color: #8D8D84; font-style: italic;">border             background         text</span>
<span style="color: #BA36A5;">focused_workspace</span>  $bg-color          $bg-color          $inactive-bg-color
<span style="color: #BA36A5;">inactive_workspace</span> $inactive-bg-color $inactive-bg-color $inactive-text-color
<span style="color: #BA36A5;">urgent_workspace</span>   $urgent-bg-color   $urgent-bg-color   $inactive-bg-color
<span style="color: #BA36A5;">}</span>
<span style="color: #BA36A5;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a9a52d" class="outline-3">
<h3 id="org9a9a52d"><span class="section-number-3">13.2.</span> .config/sway/i3status wrapper.py</h3>
<div class="outline-text-3" id="text-13-2">
<p>
This small python wrapper adds the currently playing song as a prefix to the status.
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #0000FF;">import</span> json
<span style="color: #0000FF;">import</span> subprocess
<span style="color: #0000FF;">import</span> sys

<span style="color: #0000FF;">def</span> <span style="color: #006699;">get_status</span><span style="color: #707183;">()</span>:
    <span style="color: #BA36A5;">status</span> <span style="color: #0000FF;">=</span> subprocess.<span style="color: #006DAF; font-style: italic;">getoutput</span><span style="color: #707183;">(</span><span style="color: #008000;">'playerctl status'</span><span style="color: #707183;">)</span>
    <span style="color: #0000FF;">if</span> <span style="color: #008000;">'Playing'</span> <span style="color: #0000FF;">in</span> status:
        <span style="color: #0000FF;">return</span> <span style="color: #008000;">"&#9654;&#65039;"</span>
    <span style="color: #0000FF;">elif</span> <span style="color: #008000;">'Paused'</span> <span style="color: #0000FF;">in</span> status:
        <span style="color: #0000FF;">return</span> <span style="color: #008000;">"&#9208;&#65039;"</span>
    <span style="color: #0000FF;">elif</span> <span style="color: #008000;">'Stopped'</span> <span style="color: #0000FF;">in</span> status:
        <span style="color: #0000FF;">return</span> <span style="color: #008000;">"&#9209;&#65039;"</span>
    <span style="color: #0000FF;">else</span>:
        <span style="color: #0000FF;">return</span> <span style="color: #008000;">""</span>

<span style="color: #0000FF;">def</span> <span style="color: #006699;">get_current_music_title</span><span style="color: #707183;">()</span>:
    <span style="color: #BA36A5;">title</span> <span style="color: #0000FF;">=</span> subprocess.<span style="color: #006DAF; font-style: italic;">getoutput</span><span style="color: #707183;">(</span><span style="color: #008000;">'playerctl metadata title'</span><span style="color: #707183;">)</span>
    <span style="color: #0000FF;">if</span> <span style="color: #008000;">'No players found'</span> <span style="color: #0000FF;">in</span> title:
        <span style="color: #0000FF;">return</span> <span style="color: #008000;">""</span>
    <span style="color: #BA36A5;">artist</span> <span style="color: #0000FF;">=</span> subprocess.<span style="color: #006DAF; font-style: italic;">getoutput</span><span style="color: #707183;">(</span><span style="color: #008000;">'playerctl metadata artist'</span><span style="color: #707183;">)</span>
    <span style="color: #BA36A5;">status</span> <span style="color: #0000FF;">=</span> <span style="color: #006DAF;">get_status</span><span style="color: #707183;">()</span>
    <span style="color: #0000FF;">return</span> <span style="color: #008000;">f"</span><span style="color: #008000;">{</span><span style="color: #008000; background-color: #FFFFFF;">status</span><span style="color: #008000;">}</span><span style="color: #008000;"> </span><span style="color: #008000;">{</span><span style="color: #008000; background-color: #FFFFFF;">artist</span><span style="color: #008000;">}</span><span style="color: #008000;"> - </span><span style="color: #008000;">{</span><span style="color: #008000; background-color: #FFFFFF;">title</span><span style="color: #008000;">}</span><span style="color: #008000;">"</span>

<span style="color: #0000FF;">def</span> <span style="color: #006699;">print_line</span><span style="color: #707183;">(</span><span style="color: #BA36A5;">message</span><span style="color: #707183;">)</span>:
    <span style="color: #008000; font-style: italic;">""" Non-buffered printing to stdout. """</span>
    sys.<span style="color: #D0372D; font-style: italic;">stdout</span>.<span style="color: #006DAF; font-style: italic;">write</span><span style="color: #707183;">(</span>message <span style="color: #0000FF;">+</span> <span style="color: #008000;">'</span><span style="color: #008000;">\n</span><span style="color: #008000;">'</span><span style="color: #707183;">)</span>
    sys.<span style="color: #D0372D; font-style: italic;">stdout</span>.<span style="color: #006DAF; font-style: italic;">flush</span><span style="color: #707183;">()</span>

<span style="color: #0000FF;">def</span> <span style="color: #006699;">read_line</span><span style="color: #707183;">()</span>:
    <span style="color: #008000; font-style: italic;">""" Interrupted respecting reader for stdin. """</span>
    <span style="color: #8D8D84; font-style: italic;"># try reading a line, removing any extra whitespace</span>
    <span style="color: #0000FF;">try</span>:
        <span style="color: #BA36A5;">line</span> <span style="color: #0000FF;">=</span> sys.<span style="color: #D0372D; font-style: italic;">stdin</span>.<span style="color: #006DAF; font-style: italic;">readline</span><span style="color: #707183;">()</span>.<span style="color: #006DAF; font-style: italic;">strip</span><span style="color: #707183;">()</span>
        <span style="color: #8D8D84; font-style: italic;"># i3status sends EOF, or an empty line</span>
        <span style="color: #0000FF;">if</span> <span style="color: #0000FF;">not</span> line:
            sys.<span style="color: #006DAF; font-style: italic;">exit</span><span style="color: #707183;">(</span><span style="color: #D0372D;">3</span><span style="color: #707183;">)</span>
        <span style="color: #0000FF;">return</span> line
    <span style="color: #8D8D84; font-style: italic;"># exit on ctrl-c</span>
    <span style="color: #0000FF;">except</span> <span style="color: #6434A3;">KeyboardInterrupt</span>:
        sys.<span style="color: #006DAF; font-style: italic;">exit</span><span style="color: #707183;">()</span>


<span style="color: #0000FF;">if</span> <span style="color: #006FE0;">__name__</span> <span style="color: #0000FF;">==</span> <span style="color: #008000;">'__main__'</span>:
    <span style="color: #8D8D84; font-style: italic;"># Skip the first line which contains the version header.</span>
    <span style="color: #006DAF;">print_line</span><span style="color: #707183;">(</span><span style="color: #006DAF;">read_line</span><span style="color: #7388D6;">()</span><span style="color: #707183;">)</span>

    <span style="color: #8D8D84; font-style: italic;"># The second line contains the start of the infinite array.</span>
    <span style="color: #006DAF;">print_line</span><span style="color: #707183;">(</span><span style="color: #006DAF;">read_line</span><span style="color: #7388D6;">()</span><span style="color: #707183;">)</span>

    <span style="color: #0000FF;">while</span> <span style="color: #006FE0;">True</span>:
        <span style="color: #BA36A5;">line</span>, <span style="color: #BA36A5;">prefix</span> <span style="color: #0000FF;">=</span> <span style="color: #006DAF;">read_line</span><span style="color: #707183;">()</span>, <span style="color: #008000;">''</span>

        <span style="color: #8D8D84; font-style: italic;"># ignore comma at start of lines</span>
        <span style="color: #0000FF;">if</span> line.<span style="color: #006DAF; font-style: italic;">startswith</span><span style="color: #707183;">(</span><span style="color: #008000;">','</span><span style="color: #707183;">)</span>:
            <span style="color: #BA36A5;">line</span>, <span style="color: #BA36A5;">prefix</span> <span style="color: #0000FF;">=</span> line<span style="color: #707183;">[</span><span style="color: #D0372D;">1</span>:<span style="color: #707183;">]</span>, <span style="color: #008000;">','</span>
        <span style="color: #BA36A5;">j</span> <span style="color: #0000FF;">=</span> json.<span style="color: #006DAF; font-style: italic;">loads</span><span style="color: #707183;">(</span>line<span style="color: #707183;">)</span>

        <span style="color: #BA36A5;">music_title</span> <span style="color: #0000FF;">=</span> <span style="color: #006DAF;">get_current_music_title</span><span style="color: #707183;">()</span>
        <span style="color: #8D8D84; font-style: italic;"># this is where the magic happens</span>
        <span style="color: #8D8D84; font-style: italic;"># https://i3wm.org/docs/i3bar-protocol.html</span>
        j.<span style="color: #006DAF; font-style: italic;">insert</span><span style="color: #707183;">(</span><span style="color: #D0372D;">0</span>, <span style="color: #7388D6;">{</span>
            <span style="color: #8D8D84; font-style: italic;"># 'background': '#FFFFFF',</span>
            <span style="color: #008000;">'full_text'</span>: <span style="color: #008000;">'%s'</span> <span style="color: #0000FF;">%</span> music_title,
            <span style="color: #008000;">'color'</span>: <span style="color: #008000;">'#b19cd8'</span>,
            <span style="color: #008000;">'name'</span>: <span style="color: #008000;">'music_title'</span>,
            <span style="color: #008000;">'separator_block_width'</span>: <span style="color: #D0372D;">0</span><span style="color: #7388D6;">}</span><span style="color: #707183;">)</span>
        j.<span style="color: #006DAF; font-style: italic;">insert</span><span style="color: #707183;">(</span><span style="color: #D0372D;">1</span>, <span style="color: #7388D6;">{</span>
            <span style="color: #8D8D84; font-style: italic;"># 'background': '#FFFFFF',</span>
            <span style="color: #008000;">'full_text'</span>: <span style="color: #008000;">' || '</span>,
            <span style="color: #008000;">'color'</span>: <span style="color: #008000;">'#FFFFFF'</span>,
            <span style="color: #008000;">'name'</span>: <span style="color: #008000;">'separator'</span>,
            <span style="color: #008000;">'separator_block_width'</span>: <span style="color: #D0372D;">0</span><span style="color: #7388D6;">}</span><span style="color: #707183;">)</span>

        <span style="color: #006DAF;">print_line</span><span style="color: #707183;">(</span>prefix<span style="color: #0000FF;">+</span>json.<span style="color: #006DAF; font-style: italic;">dumps</span><span style="color: #7388D6;">(</span>j<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4f93d9" class="outline-3">
<h3 id="orgf4f93d9"><span class="section-number-3">13.3.</span> .config/i3status/config</h3>
<div class="outline-text-3" id="text-13-3">
<p>
This is the actual i3status config.
</p>

<p>
Let's set some colors first of all.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #6434A3;">general</span> {
<span style="color: #BA36A5;">output_format</span> = <span style="color: #008000;">"i3bar"</span>
<span style="color: #BA36A5;">colors</span> = true
<span style="color: #BA36A5;">color_good</span> = <span style="color: #008000;">"#a3be8c"</span>
<span style="color: #BA36A5;">color_degraded</span> = <span style="color: #008000;">"#ebcb8b"</span>
<span style="color: #BA36A5;">color_bad</span> = <span style="color: #008000;">"#bf616a"</span>
<span style="color: #BA36A5;">interval</span> = 1
<span style="color: #BA36A5;">}</span>
</pre>
</div>

<p>
Now set the order of the items.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #BA36A5;">order</span> += <span style="color: #008000;">"ethernet _first_"</span>
<span style="color: #BA36A5;">order</span> += separator
<span style="color: #BA36A5;">order</span> += <span style="color: #008000;">"volume master"</span>
<span style="color: #BA36A5;">order</span> += separator
<span style="color: #BA36A5;">order</span> += <span style="color: #008000;">"tztime local"</span>
</pre>
</div>

<p>
And configure the individual items.
</p>
<div class="org-src-container">
<pre class="src src-conf-space"><span style="color: #6434A3;">volume master</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"|| &#128266; %volume"</span>
<span style="color: #BA36A5;">format_muted</span> = <span style="color: #008000;">"|| &#128263; (%volume)"</span>
<span style="color: #BA36A5;">device</span> = <span style="color: #008000;">"default"</span>
<span style="color: #BA36A5;">mixer</span> = <span style="color: #008000;">"Master"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">wireless _first_</span> {
<span style="color: #BA36A5;">format_up</span> = <span style="color: #008000;">"W: (%quality at %essid) %ip"</span>
<span style="color: #BA36A5;">format_down</span> = <span style="color: #008000;">"W: down"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">ethernet _first_</span> {
<span style="color: #BA36A5;">format_up</span> = <span style="color: #008000;">"&#127759; %ip"</span>
<span style="color: #BA36A5;">format_down</span> = <span style="color: #008000;">"&#128683; net down"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">battery all</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"%status %percentage %remaining"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #BA36A5;">disk</span> <span style="color: #008000;">"/"</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"%avail"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">load</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"%1min"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">memory</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"%used | %available"</span>
<span style="color: #BA36A5;">threshold_degraded</span> = <span style="color: #008000;">"1G"</span>
<span style="color: #BA36A5;">format_degraded</span> = <span style="color: #008000;">"MEMORY &lt; %available"</span>
<span style="color: #BA36A5;">}</span>

<span style="color: #6434A3;">tztime local</span> {
<span style="color: #BA36A5;">format</span> = <span style="color: #008000;">"|| &#128467;&#65039; %H:%M %d.%m.%Y"</span>
<span style="color: #BA36A5;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdd2db68" class="outline-2">
<h2 id="orgdd2db68"><span class="section-number-2">14.</span> Icons</h2>
<div class="outline-text-2" id="text-14">
<p>
This modules provides custom icons.
</p>
</div>
</div>

<div id="outline-container-org32723e6" class="outline-2">
<h2 id="org32723e6"><span class="section-number-2">15.</span> Rofi</h2>
<div class="outline-text-2" id="text-15">
<p>
Wofi is an application launcher, I use it with sway and sometimes even with different desktop environments.
</p>
</div>

<div id="outline-container-org4e8b2c9" class="outline-3">
<h3 id="org4e8b2c9"><span class="section-number-3">15.1.</span> .config/wofi/nord.rasi</h3>
<div class="outline-text-3" id="text-15-1">
<p>
This is my chosen wofi theme, fits with the sway theme!
Original source <a href="https://github.com/lr-tech/rofi-themes-collection">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-css"><span style="color: #006FE0;">*</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">font</span>:   <span style="color: #008000;">"Fira Code 10"</span>;

    <span style="color: #BA36A5;">nord0</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">2e3440</span>;
    <span style="color: #BA36A5;">nord1</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">3b4252</span>;
    <span style="color: #BA36A5;">nord2</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">434c5e</span>;
    <span style="color: #BA36A5;">nord3</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">4c566a</span>;

    <span style="color: #BA36A5;">nord4</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">d8dee9</span>;
    <span style="color: #BA36A5;">nord5</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">e5e9f0</span>;
    <span style="color: #BA36A5;">nord6</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">eceff4</span>;

    <span style="color: #BA36A5;">nord7</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">8fbcbb</span>;
    <span style="color: #BA36A5;">nord8</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">b19cd8</span>; <span style="color: #8D8D84; font-style: italic;">/* purple-ish thingy */</span>
    <span style="color: #BA36A5;">nord9</span>:     <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">81a1c1</span>;
    <span style="color: #BA36A5;">nord10</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">5e81ac</span>;
    <span style="color: #BA36A5;">nord11</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">bf616a</span>;

    <span style="color: #BA36A5;">nord12</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">d08770</span>;
    <span style="color: #BA36A5;">nord13</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">ebcb8b</span>;
    <span style="color: #BA36A5;">nord14</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">a3be8c</span>;
    <span style="color: #BA36A5;">nord15</span>:    <span style="color: #008000; background-color: #FFFFFF; font-weight: bold;">#</span><span style="color: #008000; font-weight: bold;">b48ead</span>;

    <span style="color: #BA36A5;">background-color</span>:   <span style="color: #0000FF;">transparent</span>;
    <span style="color: #BA36A5;">text-color</span>:         <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">4</span>;
    <span style="color: #BA36A5;">accent-color</span>:       <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">8</span>;

    <span style="color: #BA36A5;">margin</span>:     <span style="color: #D0372D;">0</span><span style="color: #6434A3;">px</span>;
    <span style="color: #BA36A5;">padding</span>:    <span style="color: #D0372D;">0</span><span style="color: #6434A3;">px</span>;
    <span style="color: #BA36A5;">spacing</span>:    <span style="color: #D0372D;">0</span><span style="color: #6434A3;">px</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">window</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">location</span>:           <span style="color: #0000FF;">north</span>;
    <span style="color: #BA36A5;">width</span>:              <span style="color: #D0372D;">100</span><span style="color: #6434A3;">%</span>;
    <span style="color: #BA36A5;">background-color</span>:   <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">0</span>;
    <span style="color: #BA36A5;">children</span>:           <span style="color: #7388D6;">[</span> <span style="color: #0000FF;">mainbox</span><span style="color: #333333; background-color: #FFFFFF;">,</span><span style="color: #0000FF;">message</span> <span style="color: #7388D6;">]</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">mainbox</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">orientation</span>:    <span style="color: #0000FF;">horizontal</span>;
    <span style="color: #BA36A5;">children</span>:       <span style="color: #7388D6;">[</span> <span style="color: #0000FF;">inputbar</span><span style="color: #333333; background-color: #FFFFFF;">,</span><span style="color: #0000FF;">listview</span> <span style="color: #7388D6;">]</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">inputbar</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">width</span>:      <span style="color: #D0372D;">25</span><span style="color: #6434A3;">%</span>;
    <span style="color: #BA36A5;">padding</span>:    <span style="color: #D0372D;">1</span><span style="color: #6434A3;">px</span> <span style="color: #D0372D;">8</span><span style="color: #6434A3;">px</span>;
    <span style="color: #BA36A5;">spacing</span>:    <span style="color: #D0372D;">8</span><span style="color: #6434A3;">px</span>;
    <span style="color: #BA36A5;">children</span>:   <span style="color: #7388D6;">[</span> <span style="color: #0000FF;">prompt</span><span style="color: #333333; background-color: #FFFFFF;">,</span> <span style="color: #0000FF;">entry</span> <span style="color: #7388D6;">]</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">prompt</span><span style="color: #333333; background-color: #FFFFFF;">,</span> <span style="color: #006FE0;">entry</span><span style="color: #333333; background-color: #FFFFFF;">,</span> <span style="color: #006FE0;">element-text</span><span style="color: #333333; background-color: #FFFFFF;">,</span> <span style="color: #006FE0;">element-icon</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">vertical-align</span>: <span style="color: #D0372D;">0.5</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">prompt</span> <span style="color: #707183;">{</span>
    <span style="color: #808080; font-weight: bold;">text-color</span>: <span style="color: #0000FF;">@accent-color</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">listview</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">layout</span>: <span style="color: #0000FF;">horizontal</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">padding</span>:    <span style="color: #D0372D;">1</span><span style="color: #6434A3;">px</span> <span style="color: #D0372D;">8</span><span style="color: #6434A3;">px</span>;
    <span style="color: #BA36A5;">spacing</span>:    <span style="color: #D0372D;">4</span><span style="color: #6434A3;">px</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">normal</span> <span style="color: #006FE0;">urgent</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">text-color</span>: <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">13</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">normal</span> <span style="color: #006FE0;">active</span> <span style="color: #707183;">{</span>
    <span style="color: #808080; font-weight: bold;">text-color</span>: <span style="color: #0000FF;">@accent-color</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">selected</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">text-color</span>: <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">0</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">selected</span> <span style="color: #006FE0;">normal</span> <span style="color: #707183;">{</span>
    <span style="color: #808080; font-weight: bold;">background-color</span>:   <span style="color: #0000FF;">@accent-color</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">selected</span> <span style="color: #006FE0;">urgent</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">background-color</span>:   <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">13</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element</span> <span style="color: #006FE0;">selected</span> <span style="color: #006FE0;">active</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">background-color</span>:   <span style="color: #0000FF;">@nord</span><span style="color: #D0372D;">8</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element-icon</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">size</span>:   <span style="color: #D0372D;">0.75</span><span style="color: #6434A3;">em</span>;
<span style="color: #707183;">}</span>

<span style="color: #006FE0;">element-text</span> <span style="color: #707183;">{</span>
    <span style="color: #BA36A5;">text-color</span>: <span style="color: #0000FF;">inherit</span>;
<span style="color: #707183;">}</span> 
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgad52703" class="outline-2">
<h2 id="orgad52703"><span class="section-number-2">16.</span> Startx</h2>
<div class="outline-text-2" id="text-16">
<p>
This bit is for a custom <code>startx</code> command, made to work with Guix.
</p>
</div>

<div id="outline-container-org96cfcc5" class="outline-3">
<h3 id="org96cfcc5"><span class="section-number-3">16.1.</span> .startx</h3>
<div class="outline-text-3" id="text-16-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #BA36A5; font-style: italic;">DIR</span>=<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span>/.guix-profile

<span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">DIR</span>/bin/xinit <span style="color: #D0372D;">--</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">DIR</span>/bin/Xorg :0 vt1 <span style="color: #D0372D;">-keeptty</span> \
               <span style="color: #D0372D;">-configdir</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">DIR</span>/share/X11/xorg.conf.d \
               <span style="color: #D0372D;">-modulepath</span> <span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">DIR</span>/lib/xorg/modules
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org59576ac" class="outline-2">
<h2 id="org59576ac"><span class="section-number-2">17.</span> Xresources</h2>
<div class="outline-text-2" id="text-17">
<p>
Here I apply some basic Xorg configuration.
</p>
</div>

<div id="outline-container-orga166c8f" class="outline-3">
<h3 id="orga166c8f"><span class="section-number-3">17.1.</span> .Xresources</h3>
<div class="outline-text-3" id="text-17-1">
<p>
Just set the DPI and configure basic font rendering.
</p>
<div class="org-src-container">
<pre class="src src-conf-xdefaults"><span style="color: #BA36A5;">Xft.antialias</span>: true
<span style="color: #BA36A5;">Xft.autohint</span>: false
<span style="color: #BA36A5;">Xft.dpi</span>: 96
<span style="color: #BA36A5;">Xft.hinting</span>: true
<span style="color: #BA36A5;">Xft.hintstyle</span>: hintslight
<span style="color: #BA36A5;">Xft.lcdfilter</span>: lcddefault
<span style="color: #BA36A5;">Xft.rgba</span>: rgb
<span style="color: #BA36A5;">Emacs.Background</span>: black
</pre>
</div>
</div>
</div>

<div id="outline-container-org9186016" class="outline-3">
<h3 id="org9186016"><span class="section-number-3">17.2.</span> .xsessionrc</h3>
<div class="outline-text-3" id="text-17-2">
<p>
This here is necessary for Debian; makes Guix programs accessible from a desktop session.
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #0000FF;">export</span> <span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #ff0000; font-weight: bold; font-style: italic;">PATH</span><span style="color: #008000;">:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile/bin:/var/lib/flatpak/exports/bin:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.bin"</span>
<span style="color: #0000FF;">export</span> <span style="color: #BA36A5; font-style: italic;">XDG_DATA_DIRS</span>=<span style="color: #008000;">"</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">XDG_DATA_DIRS</span><span style="color: #008000;">:</span><span style="color: #0000FF;">$</span><span style="color: #D0372D; font-style: italic;">HOME</span><span style="color: #008000;">/.guix-profile/share"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9228135" class="outline-2">
<h2 id="org9228135"><span class="section-number-2">18.</span> XFCE 4 Terminal</h2>
<div class="outline-text-2" id="text-18">
<p>
<code>xfce4-terminal</code> is my chosen terminal emulator. It's very easy to get up and running and supports all the basic features I need.
</p>
</div>
</div>

<div id="outline-container-org0402567" class="outline-2">
<h2 id="org0402567"><span class="section-number-2">19.</span> Wallpapers</h2>
<div class="outline-text-2" id="text-19">
<p>
This module provides a few nice wallpapers I like to use. The path to these wallpapers is <code>$HOME/.local/share/wallpapers</code>.
</p>
</div>
</div>

<div id="outline-container-org6504201" class="outline-2">
<h2 id="org6504201"><span class="section-number-2">20.</span> Guix system</h2>
<div class="outline-text-2" id="text-20">
<p>
Here is my Guix system configuration, currently unused as I'm on Debian, yet always ready to deploy!
</p>
</div>

<div id="outline-container-org59c3a93" class="outline-3">
<h3 id="org59c3a93"><span class="section-number-3">20.1.</span> /etc/config.scm</h3>
<div class="outline-text-3" id="text-20-1">
<p>
Let's start by adding my custom modules. This isn't exactly clean but it is functional.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>add-to-load-path <span style="color: #008000;">"/etc/guix-modules"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now import the actual modules
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">use-modules</span> <span style="color: #7388D6;">(</span>gnu<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services dbus<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu packages gnome<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>nongnu packages linux<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>nongnu system linux-initrd<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services virtualization<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services shepherd<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services admin<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>guix channels<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services mcron<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu services docker<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>nil services mount-rshared<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>nil services virsh<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>nil packages gnome<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu packages gnome<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu packages fonts<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>gnu packages networking<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
             <span style="color: #7388D6;">(</span>srfi srfi-1<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>use-service-modules linux desktop networking ssh xorg<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>use-package-modules linux package-management<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now redefine some services. Enable nonguix substitutes and blueman for a bluetooth applet.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">%my-services</span>
  <span style="color: #7388D6;">(</span>modify-services %desktop-services
                   <span style="color: #909183;">(</span>guix-service-type config =&gt; <span style="color: #709870;">(</span>guix-configuration
                                                 <span style="color: #907373;">(</span>inherit config<span style="color: #907373;">)</span>
                                                 <span style="color: #907373;">(</span>substitute-urls
                                                  <span style="color: #6276BA;">(</span>append <span style="color: #858580;">(</span>list <span style="color: #008000;">"https://substitutes.nonguix.org"</span><span style="color: #858580;">)</span>
                                                          %default-substitute-urls<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
                                                 <span style="color: #907373;">(</span>authorized-keys
                                                  <span style="color: #6276BA;">(</span>append <span style="color: #858580;">(</span>list <span style="color: #80A880;">(</span>local-file <span style="color: #008000;">"./signing-key.pub"</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span>
                                                          %default-authorized-guix-keys<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                   <span style="color: #909183;">(</span>dbus-root-service-type config =&gt;
                                           <span style="color: #709870;">(</span>dbus-configuration <span style="color: #907373;">(</span>inherit config<span style="color: #907373;">)</span>
                                                               <span style="color: #907373;">(</span>services <span style="color: #6276BA;">(</span>list libratbag blueman<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Let's handle basic OS defaults first of all.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>operating-system

 <span style="color: #7388D6;">(</span>locale <span style="color: #008000;">"cs_CZ.utf8"</span><span style="color: #7388D6;">)</span>
 <span style="color: #7388D6;">(</span>timezone <span style="color: #008000;">"Europe/Prague"</span><span style="color: #7388D6;">)</span>
 <span style="color: #7388D6;">(</span>keyboard-layout <span style="color: #909183;">(</span>keyboard-layout <span style="color: #008000;">"cz"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>

 <span style="color: #7388D6;">(</span>host-name <span style="color: #008000;">"eternity"</span><span style="color: #7388D6;">)</span>
</pre>
</div>

<p>
Now add the necessary firmware from nonguix.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>kernel linux<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>initrd microcode-initrd<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>firmware <span style="color: #7388D6;">(</span>list linux-firmware<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
User and group setup is next in line:
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>groups 
 <span style="color: #7388D6;">(</span>cons* 
  <span style="color: #909183;">(</span>user-group <span style="color: #709870;">(</span>name <span style="color: #008000;">"games"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">For libratbagd</span>
  <span style="color: #909183;">(</span>user-group <span style="color: #709870;">(</span>name <span style="color: #008000;">"realtime"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  %base-groups<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>users <span style="color: #7388D6;">(</span>cons* <span style="color: #909183;">(</span>user-account
               <span style="color: #709870;">(</span>name <span style="color: #008000;">"nil"</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>comment <span style="color: #008000;">"(lambda () nil)"</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>group <span style="color: #008000;">"users"</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>home-directory <span style="color: #008000;">"/home/nil"</span><span style="color: #709870;">)</span>
               <span style="color: #709870;">(</span>supplementary-groups
                '<span style="color: #907373;">(</span><span style="color: #008000;">"wheel"</span> <span style="color: #008000;">"netdev"</span> <span style="color: #008000;">"audio"</span> <span style="color: #008000;">"video"</span> <span style="color: #008000;">"lp"</span> <span style="color: #008000;">"libvirt"</span> <span style="color: #008000;">"kvm"</span> <span style="color: #008000;">"games"</span> <span style="color: #008000;">"docker"</span> <span style="color: #008000;">"realtime"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
              %base-user-accounts<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Add system-level packages now; these are <b>only</b> the most necessary of packages.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>packages
 <span style="color: #7388D6;">(</span>append
  <span style="color: #909183;">(</span><span style="color: #0000FF;">map</span> specification-&gt;package
       <span style="color: #709870;">(</span>list
        <span style="color: #008000;">"nss-certs"</span>
        <span style="color: #008000;">"xf86-video-amdgpu"</span>
        <span style="color: #008000;">"amdgpu-firmware"</span>
        <span style="color: #008000;">"bluez"</span>
        <span style="color: #008000;">"blueman"</span>
        <span style="color: #008000;">"vim"</span>
        <span style="color: #008000;">"xdg-desktop-portal-gtk"</span>
        <span style="color: #008000;">"libratbag"</span>
        <span style="color: #008000;">"git"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  %base-packages<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now for the second part of service configuration - appending my own services.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>services
 <span style="color: #7388D6;">(</span>append
  <span style="color: #909183;">(</span>list
   <span style="color: #709870;">(</span>service xfce-desktop-service-type<span style="color: #709870;">)</span>

   <span style="color: #709870;">(</span>service bluetooth-service-type
                 <span style="color: #907373;">(</span>bluetooth-configuration
                  <span style="color: #6276BA;">(</span>auto-enable? #f<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
</pre>
</div>

<p>
This one is a custom service, essentially distrobox needs the root (/) to be mounted as rshared and this is currently the way to achieve this.
</p>
<div class="org-src-container">
<pre class="src src-scheme">mount-rshared-service 
</pre>
</div>

<p>
Another custom service, this one creates the transient <code>default</code> libvirt network.
</p>
<div class="org-src-container">
<pre class="src src-scheme">virsh-net-default-service
</pre>
</div>

<p>
PAM limits for Wine Esync and realtime acces for <code>jackd</code>.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>service pam-limits-service-type
         <span style="color: #7388D6;">(</span>list <span style="color: #909183;">(</span>pam-limits-entry <span style="color: #008000;">"*"</span> 'hard 'nofile 524288<span style="color: #909183;">)</span>
               <span style="color: #909183;">(</span>pam-limits-entry <span style="color: #008000;">"@realtime"</span> 'both 'rtprio 99<span style="color: #909183;">)</span>
               <span style="color: #909183;">(</span>pam-limits-entry <span style="color: #008000;">"@realtime"</span> 'both 'memlock 'unlimited<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
A simple firewall configuration. By default all incoming connections are blocked, except for those on <code>ssh</code> port 22.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>service nftables-service-type<span style="color: #707183;">)</span>
</pre>
</div>

<p>
This is a bit of a work-around&#x2026; Basically we place the linker where regular binaries expect it to be. This allows us to execute standard binaries more easily.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>extra-special-file <span style="color: #008000;">"/lib64/ld-linux-x86-64.so.2"</span>
                    <span style="color: #7388D6;">(</span>file-append glibc <span style="color: #008000;">"/lib/ld-linux-x86-64.so.2"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
And the final few services.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>set-xorg-configuration
 <span style="color: #7388D6;">(</span>xorg-configuration
  <span style="color: #909183;">(</span>keyboard-layout keyboard-layout<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>service virtlog-service-type
         <span style="color: #7388D6;">(</span>virtlog-configuration
          <span style="color: #909183;">(</span>max-clients 1000<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>service libvirt-service-type
         <span style="color: #7388D6;">(</span>libvirt-configuration
          <span style="color: #909183;">(</span>unix-sock-group <span style="color: #008000;">"libvirt"</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span>tls-port <span style="color: #008000;">"16555"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>service docker-service-type<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>service zram-device-service-type
         <span style="color: #7388D6;">(</span>zram-device-configuration
          <span style="color: #909183;">(</span>size <span style="color: #008000;">"8172M"</span><span style="color: #909183;">)</span>
          <span style="color: #909183;">(</span>compression-algorithm 'zstd<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #000000; background-color: #FFA5A5; font-weight: bold; text-decoration: underline;">)</span>
%my-services<span style="color: #000000; background-color: #FFA5A5; font-weight: bold; text-decoration: underline;">))</span>
</pre>
</div>

<p>
At last we can configure hardware-level stuff - bootloader and drives. Finally we can close the <code>operating-system</code> section.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>bootloader
 <span style="color: #7388D6;">(</span>bootloader-configuration
  <span style="color: #909183;">(</span>bootloader grub-efi-bootloader<span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>targets '<span style="color: #709870;">(</span><span style="color: #008000;">"/boot/efi"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>timeout 3<span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>keyboard-layout keyboard-layout<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>file-systems
 <span style="color: #7388D6;">(</span>cons*   
  <span style="color: #909183;">(</span>file-system
   <span style="color: #709870;">(</span>mount-point <span style="color: #008000;">"/"</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>device
    <span style="color: #907373;">(</span>uuid <span style="color: #008000;">"bf1f6abc-05d4-430f-8da3-88af822fd603"</span>
          'ext4<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>type <span style="color: #008000;">"ext4"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>file-system
   <span style="color: #709870;">(</span>mount-point <span style="color: #008000;">"/boot/efi"</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>device
    <span style="color: #907373;">(</span>uuid <span style="color: #008000;">"8111-C019"</span>
          'fat32<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>type <span style="color: #008000;">"vfat"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>file-system <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Second hard drive</span>
   <span style="color: #709870;">(</span>mount-point <span style="color: #008000;">"/mnt/media/nil/external"</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>device
    <span style="color: #907373;">(</span>uuid <span style="color: #008000;">"6e008012-794a-40ad-99e9-69825235e4c5"</span>
          'ext4<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
   <span style="color: #709870;">(</span>type <span style="color: #008000;">"ext4"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
  %base-file-systems<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #000000; background-color: #FFA5A5; font-weight: bold; text-decoration: underline;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org096c285" class="outline-3">
<h3 id="org096c285"><span class="section-number-3">20.2.</span> /etc/signing-key.pub</h3>
<div class="outline-text-3" id="text-20-2">
<p>
This is the key for nonguix.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span>public-key 
 <span style="color: #7388D6;">(</span>ecc 
  <span style="color: #909183;">(</span>curve Ed25519<span style="color: #909183;">)</span>
  <span style="color: #909183;">(</span>q #C1FD53E5D4CE971933EC50C9F307AE2171A2D3B52C804642A7A35F84F3A4EA98#<span style="color: #909183;">)</span>
  <span style="color: #7388D6;">)</span>
 <span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb6bc911" class="outline-2">
<h2 id="orgb6bc911"><span class="section-number-2">21.</span> Custom Guix Modules</h2>
<div class="outline-text-2" id="text-21">
<p>
I use some of my own custom Guix modules. These provide anything from services to (mainly) packages.
</p>
</div>

<div id="outline-container-orgcc63247" class="outline-3">
<h3 id="orgcc63247"><span class="section-number-3">21.1.</span> /etc/guix-modules/nil/packages</h3>
<div class="outline-text-3" id="text-21-1">
<p>
Let's start with the packages first.
</p>
</div>

<div id="outline-container-orge1d05bc" class="outline-4">
<h4 id="orge1d05bc"><span class="section-number-4">21.1.1.</span> brogue.scm</h4>
<div class="outline-text-4" id="text-21-1-1">
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil packages brogue</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix download<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build-system gnu<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix licenses<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages sdl<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">brogue-ce</span>
  <span style="color: #7388D6;">(</span>package
   <span style="color: #909183;">(</span>name <span style="color: #008000;">"brogue-ce"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>version <span style="color: #008000;">"1.12"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>source <span style="color: #709870;">(</span>origin
            <span style="color: #907373;">(</span>method url-fetch<span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>uri <span style="color: #6276BA;">(</span>string-append <span style="color: #008000;">"https://github.com/tmewett/BrogueCE/archive/refs/tags/v"</span> version
                                <span style="color: #008000;">".tar.gz"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">(</span>sha256
             <span style="color: #6276BA;">(</span>base32
              <span style="color: #008000;">"0a6l7j91iq0mv7zrxnlxx6ll5rfwvgfyk5h1gc9m5qzll1n3zvdf"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>build-system gnu-build-system<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>arguments
    <span style="color: #709870;">(</span>list 
     <span style="color: #006FE0;">#:make-flags</span> #~<span style="color: #907373;">(</span>list <span style="color: #008000;">"CC=gcc"</span><span style="color: #907373;">)</span>
     <span style="color: #006FE0;">#:tests?</span> #f
     <span style="color: #006FE0;">#:phases</span>
     #~<span style="color: #907373;">(</span>modify-phases %standard-phases
                      <span style="color: #6276BA;">(</span>delete 'configure<span style="color: #6276BA;">)</span>
                      <span style="color: #6276BA;">(</span>add-before 'build 'change-datadir-path
                                  <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> _
                                    <span style="color: #80A880;">(</span><span style="color: #0000FF;">map</span>
                                     <span style="color: #887070;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #707183;">(</span>substitutes<span style="color: #707183;">)</span>
                                       <span style="color: #707183;">(</span>substitute* <span style="color: #008000;">"config.mk"</span>
                                                    <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span>car substitutes<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                                                     <span style="color: #909183;">(</span>cdr substitutes<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                                     `<span style="color: #887070;">(</span><span style="color: #707183;">(</span><span style="color: #008000;">"^DATADIR := ."</span> . ,<span style="color: #7388D6;">(</span>string-append <span style="color: #008000;">"DATADIR := "</span> #$output <span style="color: #008000;">"/share"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
                                       <span style="color: #707183;">(</span><span style="color: #008000;">"^RELEASE := NO"</span> . <span style="color: #008000;">"RELEASE := YES"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
                      <span style="color: #6276BA;">(</span>replace 'install
                               <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> _
                                 <span style="color: #80A880;">(</span>mkdir-p <span style="color: #887070;">(</span>string-append #$output <span style="color: #008000;">"/bin"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span>
                                 <span style="color: #80A880;">(</span>copy-file <span style="color: #008000;">"bin/brogue"</span> <span style="color: #887070;">(</span>string-append #$output <span style="color: #008000;">"/bin/.brogue_real"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span>
                                 <span style="color: #80A880;">(</span><span style="color: #0000FF;">call-with-output-file</span> <span style="color: #887070;">(</span>string-append #$output <span style="color: #008000;">"/bin/brogue"</span><span style="color: #887070;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Wrap around executable and execute in ~/.local</span>
                                   <span style="color: #887070;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #707183;">(</span>file<span style="color: #707183;">)</span>
                                     <span style="color: #707183;">(</span>format file <span style="color: #008000;">"~A"</span> <span style="color: #7388D6;">(</span>string-append
                                                        <span style="color: #008000;">"mkdir -p \"$HOME/.local/share/brogue\" &amp;&amp; cd \"$HOME/.local/share/brogue\" &amp;&amp; "</span>
                                                        #$output <span style="color: #008000;">"/bin/.brogue_real"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span>
                                 <span style="color: #80A880;">(</span>invoke <span style="color: #008000;">"chmod"</span> <span style="color: #008000;">"+x"</span> <span style="color: #887070;">(</span>string-append #$output <span style="color: #008000;">"/bin/brogue"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span>
                                 <span style="color: #80A880;">(</span>copy-recursively <span style="color: #008000;">"bin/assets"</span> <span style="color: #887070;">(</span>string-append #$output <span style="color: #008000;">"/share/assets"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span>
                                 <span style="color: #80A880;">(</span>make-desktop-entry-file
                                  <span style="color: #887070;">(</span>string-append  #$output <span style="color: #008000;">"/share/applications/brogue.desktop"</span><span style="color: #887070;">)</span>
                                  <span style="color: #006FE0;">#:name</span> <span style="color: #008000;">"Brogue"</span>
                                  <span style="color: #006FE0;">#:exec</span> <span style="color: #008000;">"brogue"</span>
                                  <span style="color: #006FE0;">#:categories</span> '<span style="color: #887070;">(</span><span style="color: #008000;">"RolePlaying"</span> <span style="color: #008000;">"Game"</span><span style="color: #887070;">)</span>
                                  <span style="color: #006FE0;">#:keywords</span>
                                  '<span style="color: #887070;">(</span><span style="color: #008000;">"adventure"</span> <span style="color: #008000;">"singleplayer"</span><span style="color: #887070;">)</span>
                                  <span style="color: #006FE0;">#:comment</span>
                                  '<span style="color: #887070;">(</span><span style="color: #707183;">(</span>#f <span style="color: #008000;">"Brave the Dungeons of Doom!"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>inputs <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>sdl-union <span style="color: #6276BA;">(</span>list sdl2 sdl2-image<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>synopsis <span style="color: #008000;">"Brogue CE: A dungeon crawler roguelike"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>description <span style="color: #008000;">"Community fork of Brogue"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>home-page <span style="color: #008000;">"https://github.com/tmewett/BrogueCE"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>license agpl3<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org818c263" class="outline-4">
<h4 id="org818c263"><span class="section-number-4">21.1.2.</span> distrobox-docker.scm</h4>
<div class="outline-text-4" id="text-21-1-2">
<p>
Since podman isn't currently fully functional on Guix we have to use docker instead.
Unfortunately the Distrobox definition in Guix's repos relies on podman, making it practically broken. To solve this issue I modify the package to use docker instead.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil packages distrobox-docker</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages docker<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages containers<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">distrobox-docker</span>
  <span style="color: #7388D6;">(</span>package
   <span style="color: #909183;">(</span>inherit distrobox<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>name <span style="color: #008000;">"distrobox-docker"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>inputs <span style="color: #709870;">(</span>modify-inputs <span style="color: #907373;">(</span>package-inputs distrobox<span style="color: #907373;">)</span>
                          <span style="color: #907373;">(</span>append docker<span style="color: #907373;">)</span>
                          <span style="color: #907373;">(</span>append docker-cli<span style="color: #907373;">)</span>
                          <span style="color: #907373;">(</span>delete <span style="color: #008000;">"podman"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>arguments
    <span style="color: #709870;">(</span>substitute-keyword-arguments <span style="color: #907373;">(</span>package-arguments distrobox<span style="color: #907373;">)</span>
                                  <span style="color: #907373;">(</span><span style="color: #6276BA;">(</span><span style="color: #006FE0;">#:phases</span> phases<span style="color: #6276BA;">)</span>
                                   #~<span style="color: #6276BA;">(</span>modify-phases #$phases
                                                    <span style="color: #858580;">(</span>replace 'refer-to-inputs
                                                             <span style="color: #80A880;">(</span><span style="color: #0000FF;">lambda*</span> <span style="color: #887070;">(</span><span style="color: #006FE0;">#:key</span> inputs <span style="color: #006FE0;">#:allow-other-keys</span><span style="color: #887070;">)</span>
                                                               <span style="color: #887070;">(</span>copy-file <span style="color: #008000;">"distrobox-init"</span> <span style="color: #008000;">"dinit"</span><span style="color: #887070;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Temporarily move distrobox-init so it isn't affected by regex</span>
                                                               <span style="color: #887070;">(</span>substitute* <span style="color: #707183;">(</span>find-files <span style="color: #008000;">"."</span> <span style="color: #008000;">"^distrobox.*[^1]$"</span><span style="color: #707183;">)</span>
                                                                            <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"docker"</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">(</span>search-input-file inputs <span style="color: #008000;">"/bin/docker"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
                                                                            <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"wget"</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">(</span>search-input-file inputs <span style="color: #008000;">"/bin/wget"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
                                                                            <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"command -v"</span><span style="color: #7388D6;">)</span> <span style="color: #008000;">"test -x"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
                                                               <span style="color: #887070;">(</span>copy-file <span style="color: #008000;">"dinit"</span> <span style="color: #008000;">"distrobox-init"</span><span style="color: #887070;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">move distrobox-init back</span>
                                                               <span style="color: #887070;">(</span>delete-file <span style="color: #008000;">"dinit"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org80f1311" class="outline-4">
<h4 id="org80f1311"><span class="section-number-4">21.1.3.</span> emulators.scm</h4>
<div class="outline-text-4" id="text-21-1-3">
<p>
This is a custom retroarch definition, it adds the core downloader functionality which the Guix version doesn't have for licensing reasons.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil packages emulators</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>ice-9 match<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gl<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages linux<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages emulators<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">retroarch-nonfree</span>
  <span style="color: #7388D6;">(</span>package
   <span style="color: #909183;">(</span>inherit retroarch<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>name <span style="color: #008000;">"retroarch-nonfree"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>inputs <span style="color: #709870;">(</span>modify-inputs <span style="color: #907373;">(</span>package-inputs retroarch<span style="color: #907373;">)</span>
                          <span style="color: #907373;">(</span>append glu<span style="color: #907373;">)</span>
                          <span style="color: #907373;">(</span>append libaio<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>arguments
    <span style="color: #709870;">(</span>substitute-keyword-arguments <span style="color: #907373;">(</span>package-arguments retroarch<span style="color: #907373;">)</span>
                                  <span style="color: #907373;">(</span><span style="color: #6276BA;">(</span><span style="color: #006FE0;">#:phases</span> phases<span style="color: #6276BA;">)</span>
                                   #~<span style="color: #6276BA;">(</span>modify-phases #$phases
                                                    <span style="color: #858580;">(</span>replace 'configure
                                                             <span style="color: #80A880;">(</span><span style="color: #0000FF;">lambda*</span> <span style="color: #887070;">(</span><span style="color: #006FE0;">#:key</span> inputs outputs <span style="color: #006FE0;">#:allow-other-keys</span><span style="color: #887070;">)</span>
                                                               <span style="color: #887070;">(</span><span style="color: #0000FF;">let*</span> <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span>out <span style="color: #909183;">(</span>assoc-ref outputs <span style="color: #008000;">"out"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
                                                                      <span style="color: #7388D6;">(</span>etc <span style="color: #909183;">(</span>string-append out <span style="color: #008000;">"/etc"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
                                                                      <span style="color: #7388D6;">(</span>vulkan <span style="color: #909183;">(</span>assoc-ref inputs <span style="color: #008000;">"vulkan-loader"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
                                                                      <span style="color: #7388D6;">(</span>wayland-protocols <span style="color: #909183;">(</span>assoc-ref inputs
                                                                                                    <span style="color: #008000;">"wayland-protocols"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
                                                                 <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Hard-code some store file names.</span>
                                                                 <span style="color: #707183;">(</span>substitute* <span style="color: #008000;">"gfx/common/vulkan_common.c"</span>
                                                                              <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"libvulkan.so"</span><span style="color: #909183;">)</span>
                                                                               <span style="color: #909183;">(</span>string-append vulkan <span style="color: #008000;">"/lib/libvulkan.so"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
                                                                 <span style="color: #707183;">(</span>substitute* <span style="color: #008000;">"gfx/common/wayland/generate_wayland_protos.sh"</span>
                                                                              <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"/usr/local/share/wayland-protocols"</span><span style="color: #909183;">)</span>
                                                                               <span style="color: #909183;">(</span>string-append wayland-protocols
                                                                                              <span style="color: #008000;">"/share/wayland-protocols"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

                                                                 <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">The configure script does not yet accept the extra arguments</span>
                                                                 <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">(like &#8216;CONFIG_SHELL=&#8217;) passed by the default configure phase.</span>
                                                                 <span style="color: #707183;">(</span>invoke <span style="color: #008000;">"./configure"</span>
                                                                         <span style="color: #7388D6;">(</span>string-append <span style="color: #008000;">"--prefix="</span> out<span style="color: #7388D6;">)</span>
                                                                         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Non-free software are available through the core updater,</span>
                                                                         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">disable it.  See <a href="https://issues.guix.gnu.org/38360">&lt;https://issues.guix.gnu.org/38360&gt;</a>.</span>
                                                                         <span style="color: #008000;">"--disable-builtinzlib"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span>
                                                    <span style="color: #858580;">(</span>add-after 'install 'append-extra-libs
                                                               <span style="color: #80A880;">(</span><span style="color: #0000FF;">lambda*</span> <span style="color: #887070;">(</span><span style="color: #006FE0;">#:key</span> inputs <span style="color: #006FE0;">#:allow-other-keys</span><span style="color: #887070;">)</span>
                                                                 <span style="color: #887070;">(</span>wrap-program <span style="color: #707183;">(</span>string-append #$output <span style="color: #008000;">"/bin/retroarch"</span><span style="color: #707183;">)</span>
                                                                               `<span style="color: #707183;">(</span><span style="color: #008000;">"LD_LIBRARY_PATH"</span> <span style="color: #008000;">":"</span> prefix
                                                                                 <span style="color: #7388D6;">(</span>,<span style="color: #909183;">(</span>string-append #$<span style="color: #709870;">(</span>this-package-input <span style="color: #008000;">"glu"</span><span style="color: #709870;">)</span>
                                                                                                  <span style="color: #008000;">"/lib"</span> <span style="color: #008000;">":"</span>
                                                                                                  #$<span style="color: #709870;">(</span>this-package-input
                                                                                                     <span style="color: #008000;">"libaio"</span><span style="color: #709870;">)</span> <span style="color: #008000;">"/lib"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a4284a" class="outline-4">
<h4 id="org8a4284a"><span class="section-number-4">21.1.4.</span> gnome.scm</h4>
<div class="outline-text-4" id="text-21-1-4">
<p>
Since the default Gnome package in Guix ships quite a few unnecessary dependencies I make my own variant. I also replace <code>gnome-console</code> with <code>gnome-terminal</code> as it is more full-featured.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil packages gnome</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gnome<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">gnome-minimal</span>
  <span style="color: #7388D6;">(</span>package
    <span style="color: #909183;">(</span>inherit gnome<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>name <span style="color: #008000;">"gnome-minimal"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>propagated-inputs
     <span style="color: #709870;">(</span>modify-inputs <span style="color: #907373;">(</span>package-propagated-inputs gnome<span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"epiphany"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"gnome-weather"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"simple-scan"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"gnome-maps"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"cheese"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"gnome-boxes"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"gnome-console"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>delete <span style="color: #008000;">"gnome-contacts"</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>append gnome-terminal<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org13d8471" class="outline-4">
<h4 id="org13d8471"><span class="section-number-4">21.1.5.</span> steam-client.scm</h4>
<div class="outline-text-4" id="text-21-1-5">
<p>
This is nonguix's Steam but with my second drive exposed through the sandbox. A couple of missing dependencies were added too.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">SPDX-License-Identifier: GPL-3.0-or-later</span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2020 pkill-9</span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2020, 2021 ison <a href="mailto:ison%40airmail.cc">&lt;ison@airmail.cc&gt;</a></span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2021 pineapples</span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2021 Jean-Baptiste Volatier <a href="mailto:jbv%40pm.me">&lt;jbv@pm.me&gt;</a></span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2021 Kozo <a href="mailto:kozodev%40runbox.com">&lt;kozodev@runbox.com&gt;</a></span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2021, 2022 John Kehayias <a href="mailto:john.kehayias%40protonmail.com">&lt;john.kehayias@protonmail.com&gt;</a></span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2023 Giacomo Leidi <a href="mailto:goodoldpaul%40autistici.org">&lt;goodoldpaul@autistici.org&gt;</a></span>
<span style="color: #8D8D84; font-style: italic;">;;; </span><span style="color: #8D8D84; font-style: italic;">Copyright &#169; 2023 Elijah Malaby</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil packages steam-client</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>guix licenses<span style="color: #909183;">)</span> <span style="color: #006FE0;">#:prefix</span> license:<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>nonguix licenses<span style="color: #909183;">)</span> <span style="color: #006FE0;">#:prefix</span> license:<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix git-download<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix download<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build-system gnu<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build-system python<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages audio<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages base<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages bash<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages certs<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages compression<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages elf<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages file<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages fonts<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages fontutils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages freedesktop<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gawk<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gcc<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gl<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages glib<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages gnome<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages graphics<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages libbsd<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages libusb<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages linux<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages llvm<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages logging<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages lsof<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>nongnu packages nvidia<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages pciutils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages pulseaudio<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages python<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages python-web<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages python-xyz<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages toolkits<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages video<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages xorg<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>nonguix multiarch-container<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>nonguix utils<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">steam-client</span>
  <span style="color: #7388D6;">(</span>package
    <span style="color: #909183;">(</span>name <span style="color: #008000;">"steam-client"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>version <span style="color: #008000;">"1.0.0.75"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>source
     <span style="color: #709870;">(</span>origin
       <span style="color: #907373;">(</span>method url-fetch<span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>uri <span style="color: #6276BA;">(</span>string-append <span style="color: #008000;">"http://repo.steampowered.com/steam/archive/precise/steam_"</span>
                           version <span style="color: #008000;">".tar.gz"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>sha256
        <span style="color: #6276BA;">(</span>base32
         <span style="color: #008000;">"19rn29slsxv7b5fisr1jzn79bskzifbj5hmxqn2436ivwfjna9g5"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>file-name <span style="color: #6276BA;">(</span>string-append name <span style="color: #008000;">"-"</span> version <span style="color: #008000;">".tar.gz"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>build-system gnu-build-system<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>arguments
     `<span style="color: #709870;">(</span><span style="color: #006FE0;">#:tests?</span> #f <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">There are no tests.</span>
       <span style="color: #006FE0;">#:validate-runpath?</span> #f <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Looks for bin/steam which doesn't exist.</span>
       <span style="color: #006FE0;">#:make-flags</span>
       <span style="color: #907373;">(</span>list <span style="color: #008000;">"PREFIX="</span> <span style="color: #6276BA;">(</span>string-append <span style="color: #008000;">"DESTDIR="</span> <span style="color: #858580;">(</span>assoc-ref %outputs <span style="color: #008000;">"out"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
       <span style="color: #006FE0;">#:phases</span>
       <span style="color: #907373;">(</span>modify-phases %standard-phases
         <span style="color: #6276BA;">(</span>delete 'configure<span style="color: #6276BA;">)</span>
         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Patch Makefile so it creates links to the store rather than /lib.</span>
         <span style="color: #6276BA;">(</span>add-after 'unpack 'patch-makefile
           <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> _
             <span style="color: #80A880;">(</span>substitute* <span style="color: #008000;">"Makefile"</span>
               <span style="color: #887070;">(</span><span style="color: #707183;">(</span><span style="color: #008000;">"-fns "</span><span style="color: #707183;">)</span>
                <span style="color: #008000;">"-fns $(DESTDIR)"</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
         <span style="color: #6276BA;">(</span>delete 'patch-dot-desktop-files<span style="color: #6276BA;">)</span>
         <span style="color: #6276BA;">(</span>add-after 'unpack 'patch-startscript
           <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> _
             <span style="color: #80A880;">(</span>substitute* <span style="color: #008000;">"bin_steam.sh"</span>
               <span style="color: #887070;">(</span><span style="color: #707183;">(</span><span style="color: #008000;">"/usr"</span><span style="color: #707183;">)</span> <span style="color: #707183;">(</span>assoc-ref %outputs <span style="color: #008000;">"out"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
         <span style="color: #6276BA;">(</span>add-after 'patch-dot-desktop-files 'patch-desktop-file
           <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> _
             <span style="color: #80A880;">(</span><span style="color: #0000FF;">let</span> <span style="color: #887070;">(</span><span style="color: #707183;">(</span>path <span style="color: #7388D6;">(</span>string-append <span style="color: #909183;">(</span>assoc-ref %outputs <span style="color: #008000;">"out"</span><span style="color: #909183;">)</span>
                                        <span style="color: #008000;">"/share/applications/"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>substitute* <span style="color: #707183;">(</span>string-append path <span style="color: #008000;">"steam.desktop"</span><span style="color: #707183;">)</span>
                 <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"Exec=.*/steam"</span><span style="color: #7388D6;">)</span> <span style="color: #008000;">"Exec=steam-patched"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>copy-file <span style="color: #707183;">(</span>string-append path <span style="color: #008000;">"steam.desktop"</span><span style="color: #707183;">)</span>
                          <span style="color: #707183;">(</span>string-append path <span style="color: #008000;">"steam-asound32.desktop"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>substitute* <span style="color: #707183;">(</span>string-append path <span style="color: #008000;">"steam-asound32.desktop"</span><span style="color: #707183;">)</span>
                 <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"Exec=steam-patched %U"</span><span style="color: #7388D6;">)</span> <span style="color: #008000;">"Exec=steam-patched %U -- --asound32"</span><span style="color: #707183;">)</span>
                 <span style="color: #707183;">(</span><span style="color: #7388D6;">(</span><span style="color: #008000;">"Name=Steam"</span><span style="color: #7388D6;">)</span> <span style="color: #008000;">"Name=Steam (32-bit ALSA)"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Steamdeps installs missing packages, which doesn't work with Guix.</span>
         <span style="color: #6276BA;">(</span>add-after 'install-binaries 'post-install
           <span style="color: #858580;">(</span><span style="color: #0000FF;">lambda*</span> <span style="color: #80A880;">(</span><span style="color: #006FE0;">#:key</span> inputs outputs <span style="color: #006FE0;">#:allow-other-keys</span><span style="color: #80A880;">)</span>
             <span style="color: #80A880;">(</span><span style="color: #0000FF;">let</span> <span style="color: #887070;">(</span><span style="color: #707183;">(</span>out <span style="color: #7388D6;">(</span>assoc-ref %outputs <span style="color: #008000;">"out"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>delete-file <span style="color: #707183;">(</span>string-append out <span style="color: #008000;">"/lib/steam/bin_steamdeps.py"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span>
               <span style="color: #887070;">(</span>delete-file <span style="color: #707183;">(</span>string-append out <span style="color: #008000;">"/bin/steamdeps"</span><span style="color: #707183;">)</span><span style="color: #887070;">)</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>home-page <span style="color: #008000;">"https://store.steampowered.com"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>synopsis <span style="color: #008000;">"Digital distribution platform for managing and playing games"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>description <span style="color: #008000;">"Steam is a digital software distribution platform created by Valve."</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>license <span style="color: #709870;">(</span>license:nonfree <span style="color: #008000;">"file:///share/doc/steam/steam_subscriber_agreement.txt"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">steam-client-libs</span>
  `<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"bash"</span> ,bash<span style="color: #909183;">)</span>                      <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam startup.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"coreutils"</span> ,coreutils<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"diffutils"</span> ,diffutils<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"dbus-glib"</span> ,dbus-glib<span style="color: #909183;">)</span>            <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam browser.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"elfutils"</span> ,elfutils<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for capturing library dependencies in pv.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"eudev"</span> ,eudev<span style="color: #909183;">)</span>                    <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steamwebhelper/heavy runtime.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"fontconfig"</span> ,fontconfig<span style="color: #909183;">)</span>          <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam client.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"file"</span> ,file<span style="color: #909183;">)</span>                      <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Used for steam installation.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"find"</span> ,findutils<span style="color: #909183;">)</span>                 <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required at least for some logging.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"freetype"</span> ,freetype<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam login.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"gawk"</span> ,gawk<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"gcc:lib"</span> ,gcc <span style="color: #008000;">"lib"</span><span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam startup.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"grep"</span> ,grep<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libbsd"</span> ,libbsd<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libcap"</span> ,libcap<span style="color: #909183;">)</span>                  <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for SteamVR, but needs pkexec too.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libusb"</span> ,libusb<span style="color: #909183;">)</span>                  <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for SteamVR.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libva"</span> ,libva<span style="color: #909183;">)</span>                    <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for hardware video encoding/decoding.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libvdpau"</span> ,libvdpau<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for hardware video encoding/decoding.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"libvdpau-va-gl"</span> ,libvdpau-va-gl<span style="color: #909183;">)</span>  <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Additional VDPAU support.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"llvm"</span> ,llvm-for-mesa<span style="color: #909183;">)</span>             <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for mesa.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"lsof"</span> ,lsof<span style="color: #909183;">)</span>                      <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for some friend's list actions.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"mesa"</span> ,mesa<span style="color: #909183;">)</span>                      <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam startup.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"nss-certs"</span> ,nss-certs<span style="color: #909183;">)</span>            <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam login.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"pciutils"</span> ,pciutils<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Tries to run lspci at steam startup.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"procps"</span> ,procps<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"sed"</span> ,sed<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"tar"</span> ,tar<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"usbutils"</span> ,usbutils<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for SteamVR.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"util-linux"</span> ,util-linux<span style="color: #909183;">)</span>          <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for steam login.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"wayland"</span> ,wayland<span style="color: #909183;">)</span>                <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for mesa vulkan (e.g. libvulkan_radeon).</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"xdg-user-dirs"</span> ,xdg-user-dirs<span style="color: #909183;">)</span>    <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Suppress warning of missing xdg-user-dir.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"flatpak-xdg-utils"</span> ,flatpak-xdg-utils<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"xrandr"</span> ,xrandr<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"xz"</span> ,xz<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"zenity"</span> ,zenity<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for progress dialogs.</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">steam-gameruntime-libs</span>
  `<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"alsa-lib"</span> ,alsa-lib<span style="color: #909183;">)</span>              <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for audio in most games.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"alsa-plugins:pulseaudio"</span> ,alsa-plugins <span style="color: #008000;">"pulseaudio"</span><span style="color: #909183;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for audio in most games.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"font-dejavu"</span> ,font-dejavu<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"font-liberation"</span> ,font-liberation<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"imgui"</span> ,imgui-1.86<span style="color: #909183;">)</span>               <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for MangoHud.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"mangohud"</span> ,mangohud<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"openal"</span> ,openal<span style="color: #909183;">)</span>                  <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Prevents corrupt audio in Crypt of the Necrodancer.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"pulseaudio"</span> ,pulseaudio<span style="color: #909183;">)</span>          <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Prevents corrupt audio in Sven Coop.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"python"</span> ,python<span style="color: #909183;">)</span>                  <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for KillingFloor2 and Wreckfest.</span>
    <span style="color: #909183;">(</span><span style="color: #008000;">"spdlog"</span> ,spdlog<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>                <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Required for MangoHud.</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">steam-ld.so.conf</span>
  <span style="color: #7388D6;">(</span>packages-&gt;ld.so.conf
   <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>fhs-union `<span style="color: #907373;">(</span>,@steam-client-libs
                      ,@steam-gameruntime-libs
                      ,@fhs-min-libs<span style="color: #907373;">)</span>
                    <span style="color: #006FE0;">#:name</span> <span style="color: #008000;">"fhs-union-64"</span><span style="color: #709870;">)</span>
         <span style="color: #709870;">(</span>fhs-union `<span style="color: #907373;">(</span>,@steam-client-libs
                      ,@steam-gameruntime-libs
                      ,@fhs-min-libs<span style="color: #907373;">)</span>
                    <span style="color: #006FE0;">#:name</span> <span style="color: #008000;">"fhs-union-32"</span>
                    <span style="color: #006FE0;">#:system</span> <span style="color: #008000;">"i686-linux"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">steam-ld.so.cache</span>
  <span style="color: #7388D6;">(</span>ld.so.conf-&gt;ld.so.cache steam-ld.so.conf<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">steam-container</span>
  <span style="color: #7388D6;">(</span>nonguix-container
   <span style="color: #909183;">(</span>name <span style="color: #008000;">"steam-patched"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>wrap-package steam-client<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>run <span style="color: #008000;">"/bin/steam"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>ld.so.conf steam-ld.so.conf<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>ld.so.cache steam-ld.so.cache<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>exposed '<span style="color: #709870;">(</span><span style="color: #008000;">"/mnt"</span> <span style="color: #008000;">"/home/nil/.local/share/icons"</span> <span style="color: #008000;">"/home/nil/.icons"</span> <span style="color: #008000;">"/home/nil/git/emacs-stuff"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>union64
    <span style="color: #709870;">(</span>fhs-union `<span style="color: #907373;">(</span>,@steam-client-libs
                 ,@steam-gameruntime-libs
                 ,@fhs-min-libs<span style="color: #907373;">)</span>
               <span style="color: #006FE0;">#:name</span> <span style="color: #008000;">"fhs-union-64"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>union32
    <span style="color: #709870;">(</span>fhs-union `<span style="color: #907373;">(</span>,@steam-client-libs
                 ,@steam-gameruntime-libs
                 ,@fhs-min-libs<span style="color: #907373;">)</span>
               <span style="color: #006FE0;">#:name</span> <span style="color: #008000;">"fhs-union-32"</span>
               <span style="color: #006FE0;">#:system</span> <span style="color: #008000;">"i686-linux"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>link-files '<span style="color: #709870;">(</span><span style="color: #008000;">"share/applications/steam.desktop"</span>
                 <span style="color: #008000;">"share/applications/steam-asound32.desktop"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>description <span style="color: #008000;">"Steam is a digital software distribution platform created by</span>
<span style="color: #008000;">Valve.  This package provides a script for launching Steam in a Guix container</span>
<span style="color: #008000;">which will use the directory @file{$HOME/.local/share/guix-sandbox-home} where</span>
<span style="color: #008000;">all games will be installed."</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">steam-nvidia-container</span>
  <span style="color: #7388D6;">(</span>nonguix-container
   <span style="color: #909183;">(</span>inherit steam-container<span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>name <span style="color: #008000;">"steam-nvidia"</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>union64 <span style="color: #709870;">(</span>replace-mesa <span style="color: #907373;">(</span>ngc-union64 steam-container<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
   <span style="color: #909183;">(</span>union32 <span style="color: #709870;">(</span>replace-mesa <span style="color: #907373;">(</span>ngc-union32 steam-container<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">steam</span> <span style="color: #7388D6;">(</span>nonguix-container-&gt;package steam-container<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">steam-nvidia</span> <span style="color: #7388D6;">(</span>nonguix-container-&gt;package steam-nvidia-container<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">protonup-ng</span>
  <span style="color: #7388D6;">(</span>package
    <span style="color: #909183;">(</span>name <span style="color: #008000;">"protonup-ng"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>version <span style="color: #008000;">"0.2.1"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>source
     <span style="color: #709870;">(</span>origin
       <span style="color: #907373;">(</span>method git-fetch<span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>uri <span style="color: #6276BA;">(</span>git-reference
             <span style="color: #858580;">(</span>url <span style="color: #008000;">"https://github.com/cloudishBenne/protonup-ng"</span><span style="color: #858580;">)</span>
             <span style="color: #858580;">(</span>commit version<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>file-name <span style="color: #6276BA;">(</span>git-file-name name version<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
       <span style="color: #907373;">(</span>sha256
        <span style="color: #6276BA;">(</span>base32 <span style="color: #008000;">"0yd2mhhqxzarqxk85zf42s931jzc94f1cssn1hblsqghr79laa45"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>build-system python-build-system<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>arguments
     <span style="color: #709870;">(</span>list <span style="color: #006FE0;">#:tests?</span> #f<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">there are no tests</span>
    <span style="color: #909183;">(</span>inputs
     <span style="color: #709870;">(</span>list python-configparser python-requests<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>home-page <span style="color: #008000;">"https://github.com/cloudishBenne/protonup-ng"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>synopsis <span style="color: #008000;">"Manage Proton-GE Installations"</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>description <span style="color: #008000;">"ProtonUp-ng is a CLI program and API to automate the installation</span>
<span style="color: #008000;">and update of GloriousEggroll's Proton-GE."</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>license license:gpl3<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org833c9aa" class="outline-3">
<h3 id="org833c9aa"><span class="section-number-3">21.2.</span> /etc/guix-modules/nil/services</h3>
<div class="outline-text-3" id="text-21-2">
<p>
Moving on to services.
</p>
</div>

<div id="outline-container-org99cda72" class="outline-4">
<h4 id="org99cda72"><span class="section-number-4">21.2.1.</span> mount-rshared.scm</h4>
<div class="outline-text-4" id="text-21-2-1">
<p>
Tiny service used to remount the root as recursively shared on boot.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil services mount-rshared</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages linux<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu services<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu services shepherd<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build utils<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">mount-rshared-service</span>
  <span style="color: #7388D6;">(</span>simple-service 'mount-rshared shepherd-root-service-type
                  <span style="color: #909183;">(</span>list <span style="color: #709870;">(</span>shepherd-service
                         <span style="color: #907373;">(</span>provision '<span style="color: #6276BA;">(</span>mount-rshared<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
                         <span style="color: #907373;">(</span>requirement '<span style="color: #6276BA;">(</span>user-processes<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
                         <span style="color: #907373;">(</span>start #~<span style="color: #6276BA;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #858580;">()</span>
                                    <span style="color: #858580;">(</span>invoke
                                     #$<span style="color: #80A880;">(</span>file-append util-linux <span style="color: #008000;">"/bin/mount"</span><span style="color: #80A880;">)</span>
                                     <span style="color: #008000;">"--make-rshared"</span> <span style="color: #008000;">"/"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
                         <span style="color: #907373;">(</span>respawn? #f<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb461ce3" class="outline-4">
<h4 id="orgb461ce3"><span class="section-number-4">21.2.2.</span> virsh.scm</h4>
<div class="outline-text-4" id="text-21-2-2">
<p>
There doesn't seem to be a proper Guix way to configure libvirt networks so my lazy workaround is to make a service that creates the default transient network.
</p>
<div class="org-src-container">
<pre class="src src-scheme"><span style="color: #707183;">(</span><span style="color: #0000FF;">define-module</span> <span style="color: #7388D6;">(</span><span style="color: #6434A3;">nil services virsh</span><span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix gexp<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix packages<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu packages virtualization<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix utils<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu services<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>gnu services shepherd<span style="color: #7388D6;">)</span>
  <span style="color: #006FE0;">#:use-module</span> <span style="color: #7388D6;">(</span>guix build utils<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define</span> <span style="color: #006699;">default-config</span> <span style="color: #008000;">"</span>
<span style="color: #008000;">&lt;network&gt;</span>
<span style="color: #008000;">  &lt;name&gt;default&lt;/name&gt;</span>
<span style="color: #008000;">  &lt;bridge name='virbr0'/&gt;</span>
<span style="color: #008000;">  &lt;forward/&gt;</span>
<span style="color: #008000;">  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;</span>
<span style="color: #008000;">    &lt;dhcp&gt;</span>
<span style="color: #008000;">      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;</span>
<span style="color: #008000;">    &lt;/dhcp&gt;</span>
<span style="color: #008000;">  &lt;/ip&gt;</span>
<span style="color: #008000;">&lt;/network&gt;</span>
<span style="color: #008000;">"</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-public</span> <span style="color: #006699;">virsh-net-default-service</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>config <span style="color: #907373;">(</span>plain-file <span style="color: #008000;">"default.xml"</span> default-config<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>simple-service 'virsh-net-default-service shepherd-root-service-type
                    <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>shepherd-service
                           <span style="color: #6276BA;">(</span>provision '<span style="color: #858580;">(</span>virsh-net-default<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
                           <span style="color: #6276BA;">(</span>requirement '<span style="color: #858580;">(</span>libvirtd NetworkManager<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
                           <span style="color: #6276BA;">(</span>start #~<span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #80A880;">()</span>
                                      <span style="color: #80A880;">(</span>invoke
                                       #$<span style="color: #887070;">(</span>file-append libvirt <span style="color: #008000;">"/bin/virsh"</span><span style="color: #887070;">)</span>
                                       <span style="color: #008000;">"net-create"</span> #$config<span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
                           <span style="color: #6276BA;">(</span>stop #~<span style="color: #858580;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #80A880;">()</span>
                                     <span style="color: #80A880;">(</span>invoke
                                      #$<span style="color: #887070;">(</span>file-append libvirt <span style="color: #008000;">"/bin/virsh"</span><span style="color: #887070;">)</span>
                                      <span style="color: #008000;">"net-destroy"</span> <span style="color: #008000;">"default"</span><span style="color: #80A880;">)</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
                           <span style="color: #6276BA;">(</span>respawn? #f<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org5c16ac8" class="outline-2">
<h2 id="org5c16ac8"><span class="section-number-2">22.</span> ZRAM on non-guix distros</h2>
<div class="outline-text-2" id="text-22">
<p>
This is the distribution-agnostic ZRAM implementation for use with systems other than GNU Guix. This module isn't necessary (or desired) with Guix System.
</p>
<ul class="org-ul">
<li>Dependent on <code>systemd</code>.</li>
<li>It is necessary to manually disable regular swap in <code>/etc/fstab</code>.</li>
<li>It might be necessary to copy the files over rather than symlink them.</li>
</ul>
</div>

<div id="outline-container-orgd64fcc0" class="outline-3">
<h3 id="orgd64fcc0"><span class="section-number-3">22.1.</span> /etc/modules-load.d/zram.conf</h3>
<div class="outline-text-3" id="text-22-1">
<p>
First load the kernel module.
</p>
<div class="org-src-container">
<pre class="src src-conf-unix">zram            
</pre>
</div>
</div>
</div>

<div id="outline-container-org84febd5" class="outline-3">
<h3 id="org84febd5"><span class="section-number-3">22.2.</span> /etc/modprobe.d/zram.conf</h3>
<div class="outline-text-3" id="text-22-2">
<p>
Now to configure the module a little bit.
</p>
<div class="org-src-container">
<pre class="src src-conf-unix"><span style="color: #BA36A5;">options zram num_devices</span>=1
</pre>
</div>
</div>
</div>

<div id="outline-container-org82eb147" class="outline-3">
<h3 id="org82eb147"><span class="section-number-3">22.3.</span> /etc/udev/rules.d/99-zram.rules</h3>
<div class="outline-text-3" id="text-22-3">
<p>
Set the ZRAM size - 16GB in this case.
</p>
<div class="org-src-container">
<pre class="src src-conf-unix"><span style="color: #BA36A5;">KERNEL</span>==<span style="color: #008000;">"zram0"</span>, ATTR{disksize}=<span style="color: #008000;">"16384M"</span>,TAG+=<span style="color: #008000;">"systemd"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4810dc7" class="outline-3">
<h3 id="org4810dc7"><span class="section-number-3">22.4.</span> /etc/systemd/system/zram.service</h3>
<div class="outline-text-3" id="text-22-4">
<p>
Finally we need a systemd service to automatically enable zram on boot.
</p>
<div class="org-src-container">
<pre class="src src-systemd"><span style="color: #6434A3;">[Unit]</span>
<span style="color: #0000FF;">Description</span>=Swap with zram
<span style="color: #0000FF;">After</span>=multi-user.target

<span style="color: #6434A3;">[Service]</span>
<span style="color: #0000FF;">Type</span>=<span style="color: #006FE0;">oneshot</span>
<span style="color: #0000FF;">RemainAfterExit</span>=<span style="color: #D0372D;">true</span>
<span style="color: #0000FF;">ExecStartPre</span>=/sbin/mkswap /dev/zram0
<span style="color: #0000FF;">ExecStart</span>=/sbin/swapon /dev/zram0
<span style="color: #0000FF;">ExecStop</span>=/sbin/swapoff /dev/zram0

<span style="color: #6434A3;">[Install]</span>
<span style="color: #0000FF;">WantedBy</span>=multi-user.target
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4d2edd" class="outline-2">
<h2 id="orgc4d2edd"><span class="section-number-2">23.</span> Emacs</h2>
<div class="outline-text-2" id="text-23">
<p>
Finally - this is my Emacs config, now fully literate!
</p>

<p>
It's pretty full-featured, yet rather short and straightforward. I try to keep this config as readable and maintainable as possible
</p>



<p>
Let's start with a quick listing of the relevant system-level dependencies, these are the names in Guix:
</p>
<ul class="org-ul">
<li><code>clang</code></li>
<li><code>ripgrep</code></li>
<li><code>font-fira-mono</code></li>
<li><code>sbcl</code></li>
<li><code>clang</code></li>
<li><code>cmake</code></li>
<li><code>make</code></li>
<li><code>enchant</code></li>
<li><code>hunspell</code></li>
<li><code>hunspell-dict-en-us</code></li>
<li><code>libtool</code></li>
<li><code>gcc-toolchain</code></li>
<li><code>guile</code></li>
</ul>
<p>
I usually install these using <a href="https://guix.gnu.org">GNU Guix</a>, at least when running Emacs on Linux.
</p>
</div>

<div id="outline-container-org12e4c37" class="outline-3">
<h3 id="org12e4c37"><span class="section-number-3">23.1.</span> Initial variables</h3>
<div class="outline-text-3" id="text-23-1">
<p>
Set some basic information about the user.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> user-mail-address <span style="color: #008000;">"shadenk30011@gmail.com"</span>
      user-full-name <span style="color: #008000;">"(&#955; () nil)"</span><span style="color: #707183;">)</span>
</pre>
</div>


<p>
EXWM can be toggled here. Its configuration is handled within a separate file.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">use-exwm</span> nil<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">when</span> use-exwm <span style="color: #7388D6;">(</span>load <span style="color: #008000;">"~/.exwm.el"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7049b67" class="outline-3">
<h3 id="org7049b67"><span class="section-number-3">23.2.</span> Packages</h3>
<div class="outline-text-3" id="text-23-2">
<p>
Next we need to setup our package archives so that we can ensure all the necessary packages are installed. We'll also grab <code>el-patch</code> as it needs to have priority over other packages.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">package</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-to-list 'package-archives '<span style="color: #7388D6;">(</span><span style="color: #008000;">"melpa"</span> . <span style="color: #008000;">"https://melpa.org/packages/"</span><span style="color: #7388D6;">)</span> t<span style="color: #707183;">)</span>
<span style="color: #8D8D84; font-style: italic;">;;</span><span style="color: #8D8D84; font-style: italic;">(add-to-list 'package-archives '("melpa-stable" . "https://stable.melpa.org/packages/") t)</span>
<span style="color: #707183;">(</span>package-initialize<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #7388D6;">(</span>package-installed-p 'el-patch<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>package-install 'el-patch<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">el-patch</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Here is the list of packages to be patched with <code>el-patch</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">dolist</span> <span style="color: #7388D6;">(</span>package '<span style="color: #909183;">(</span>elcord
                   nyan-mode<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #909183;">(</span>package-installed-p package<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>package-install package<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
A small patch needs to be applied before we start setting up packages - the <code>elcord</code> package needs to be patched to work with flatpak Discord.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">(el-patch-feature elcord)</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">(el-patch-defvar elcord--discord-ipc-pipe "app/com.discordapp.Discord/discord-ipc-0")</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">el-patch-feature</span> nyan-mode<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">el-patch-defconst</span> <span style="color: #BA36A5;">nyan-directory</span> <span style="color: #7388D6;">(</span>file-name-directory <span style="color: #008000;">"~/.emacs.d/nyan-custom/img"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Finally it's time to go over the package list and install everything.
You'll notice the use of a very primitive function - no <code>straight.el</code> or <code>use-package</code> here!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">dolist</span> <span style="color: #7388D6;">(</span>package '<span style="color: #909183;">(</span>dumb-jump
                   company
                   ivy
                   sudo-edit
                   json-mode
                   sly
                   transmission
                   vterm
                   elfeed
                   which-key
                   magit
                   guix
                   systemd
                   spacious-padding
                   jinx
                   toc-org
                   tempel
                   tempel-collection
                   yaml-mode
                   tree-sitter
                   tree-sitter-langs
                   emms
                   lsp-pyright
                   treemacs
                   doom-themes
                   treemacs-all-the-icons
                   markdown-mode
                   impatient-mode
                   ement
                   counsel
                   lsp-mode
                   rainbow-delimiters
                   ligature
                   flycheck
                   geiser
                   go-mode
                   geiser-guile
                   org-present
                   visual-fill-column
                   org-bullets
                   web-mode<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #909183;">(</span>package-installed-p package<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>package-install package<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">require</span> <span style="color: #D0372D;">package</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8dd54aa" class="outline-3">
<h3 id="org8dd54aa"><span class="section-number-3">23.3.</span> Extra tempel templates (.emacs.d/templates)</h3>
<div class="outline-text-3" id="text-23-3">
<p>
I use <code>tempel</code> for inserting snippets. This is the default path for adding new snippets.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">~/.config/emacs/templates</span>

org-mode

<span style="color: #707183;">(</span>file <span style="color: #008000;">"#+TITLE: "</span> p n <span style="color: #008000;">"#+AUTHOR: "</span> p n <span style="color: #008000;">"#+SETUPFILE: ~/.org-html.css.org"</span> n <span style="color: #008000;">"#+OPTIONS: toc:nil num:nil author:nil date:nil timestamp:nil html-postamble:nil"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>blog <span style="color: #008000;">"#+OPTIONS: toc:nil num:nil"</span> n <span style="color: #008000;">"#+BEGIN_EXPORT html"</span> n <span style="color: #008000;">"---"</span> n <span style="color: #008000;">"layout: post"</span> n <span style="color: #008000;">"title: "</span> p n <span style="color: #008000;">"permalink: /:title/"</span> n <span style="color: #008000;">"tags: [emacs]"</span> n <span style="color: #008000;">"---"</span> n <span style="color: #008000;">"#+END_EXPORT"</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Local Variables&#58;</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">mode: lisp-data</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">outline-regexp: "[a-z]"</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">End:</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab9b427" class="outline-3">
<h3 id="orgab9b427"><span class="section-number-3">23.4.</span> custom-set options</h3>
<div class="outline-text-3" id="text-23-4">
<p>
Now we set some custom variables related mostly to theming. This part here was automatically generated by Emacs.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>custom-set-variables
 '<span style="color: #7388D6;">(</span>column-number-mode t<span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>ement-save-sessions t<span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>custom-enabled-themes '<span style="color: #909183;">(</span>doom-dracula<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>custom-safe-themes
   '<span style="color: #909183;">(</span><span style="color: #008000;">"8c7e832be864674c220f9a9361c851917a93f921fedb7717b1b5ece47690c098"</span> <span style="color: #008000;">"944d52450c57b7cbba08f9b3d08095eb7a5541b0ecfb3a0a9ecd4a18f3c28948"</span> <span style="color: #008000;">"631c52620e2953e744f2b56d102eae503017047fb43d65ce028e88ef5846ea3b"</span> <span style="color: #008000;">"1a1ac598737d0fcdc4dfab3af3d6f46ab2d5048b8e72bc22f50271fd6d393a00"</span> <span style="color: #008000;">"7ea883b13485f175d3075c72fceab701b5bf76b2076f024da50dff4107d0db25"</span> <span style="color: #008000;">"37768a79b479684b0756dec7c0fc7652082910c37d8863c35b702db3f16000f8"</span> <span style="color: #008000;">"ae426fc51c58ade49774264c17e666ea7f681d8cae62570630539be3d06fd964"</span> <span style="color: #008000;">"fee7287586b17efbfda432f05539b58e86e059e78006ce9237b8732fde991b4c"</span> <span style="color: #008000;">"bfc0b9c3de0382e452a878a1fb4726e1302bf9da20e69d6ec1cd1d5d82f61e3d"</span> <span style="color: #008000;">"dde643b0efb339c0de5645a2bc2e8b4176976d5298065b8e6ca45bc4ddf188b7"</span> <span style="color: #008000;">"bffa9739ce0752a37d9b1eee78fc00ba159748f50dc328af4be661484848e476"</span> <span style="color: #008000;">"12ce0ae7f9f5ba28e7252d9464daea32aa0884646b6576b949edfb2ccf2bf9d4"</span> <span style="color: #008000;">"da75eceab6bea9298e04ce5b4b07349f8c02da305734f7c0c8c6af7b5eaa9738"</span> <span style="color: #008000;">"2dd4951e967990396142ec54d376cced3f135810b2b69920e77103e0bcedfba9"</span> <span style="color: #008000;">"7a424478cb77a96af2c0f50cfb4e2a88647b3ccca225f8c650ed45b7f50d9525"</span> <span style="color: #008000;">"6945dadc749ac5cbd47012cad836f92aea9ebec9f504d32fe89a956260773ca4"</span> <span style="color: #008000;">"aec7b55f2a13307a55517fdf08438863d694550565dee23181d2ebd973ebd6b8"</span> default<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>delete-selection-mode t<span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>org-safe-remote-resources
   '<span style="color: #909183;">(</span><span style="color: #008000;">"\\`</span><span style="color: #D0372D;">https://fniessen\\.github\\.io/org-html-themes/org/theme-readtheorg\\.setup\\</span><span style="color: #008000;">'"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>package-selected-packages
   '<span style="color: #909183;">(</span>org-present org-roam web-mode doom-themes vterm sly sudo-edit pacmacs rainbow-mode eglot nord-theme nyan-mode rainbow-delimiters tree-sitter-langs tree-sitter magit treemacs-icons-dired spacemacs-theme treemacs-all-the-icons treemacs guix emms elfeed impatient-mode company-plisp sly-quicklisp ligature markdown-mode ivy flycheck company dumb-jump<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>safe-local-variable-values
   '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>eval modify-syntax-entry 43 <span style="color: #008000;">"'"</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>eval modify-syntax-entry 36 <span style="color: #008000;">"'"</span><span style="color: #709870;">)</span>
     <span style="color: #709870;">(</span>eval modify-syntax-entry 126 <span style="color: #008000;">"'"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>warning-suppress-types '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>comp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>comp<span style="color: #709870;">)</span> <span style="color: #709870;">(</span>emacs<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>custom-set-faces
 '<span style="color: #7388D6;">(</span>ement-room-message-text <span style="color: #909183;">(</span><span style="color: #709870;">(</span>t <span style="color: #907373;">(</span><span style="color: #006FE0;">:inherit</span> <span style="color: #6276BA;">(</span>variable-pitch default<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>ement-room-name <span style="color: #909183;">(</span><span style="color: #709870;">(</span>t <span style="color: #907373;">(</span><span style="color: #006FE0;">:inherit</span> <span style="color: #6276BA;">(</span>variable-pitch font-lock-function-name-face<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>erc-default-face <span style="color: #909183;">(</span><span style="color: #709870;">(</span>t <span style="color: #907373;">(</span><span style="color: #006FE0;">:inherit</span> <span style="color: #6276BA;">(</span>variable-pitch default<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
 '<span style="color: #7388D6;">(</span>erc-nick-default-face <span style="color: #909183;">(</span><span style="color: #709870;">(</span>t <span style="color: #907373;">(</span><span style="color: #006FE0;">:inherit</span> variable-pitch <span style="color: #006FE0;">:weight</span> bold<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
The Fira Code font has ligature support, so we implement it here.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">dolist</span> <span style="color: #7388D6;">(</span>char/ligature-re
         `<span style="color: #909183;">(</span><span style="color: #709870;">(</span>?-  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"--&gt;"</span> <span style="color: #008000;">"-&lt;&lt;"</span> <span style="color: #008000;">"-&gt;&gt;"</span> <span style="color: #008000;">"-|"</span> <span style="color: #008000;">"-~"</span> <span style="color: #008000;">"-&lt;"</span> <span style="color: #008000;">"-&gt;"</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"-"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?/  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"/=="</span> <span style="color: #008000;">"/="</span> <span style="color: #008000;">"/&gt;"</span> <span style="color: #008000;">"/**"</span> <span style="color: #008000;">"/*"</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"/"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?*  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"*&gt;"</span> <span style="color: #008000;">"*/"</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"*"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?&lt;  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"&lt;&lt;="</span> <span style="color: #008000;">"&lt;&lt;-"</span> <span style="color: #008000;">"&lt;|||"</span> <span style="color: #008000;">"&lt;==&gt;"</span> <span style="color: #008000;">"&lt;!--"</span> <span style="color: #008000;">"&lt;=&gt;"</span> <span style="color: #008000;">"&lt;||"</span> <span style="color: #008000;">"&lt;|&gt;"</span> <span style="color: #008000;">"&lt;-&lt;"</span>
                             <span style="color: #008000;">"&lt;=="</span> <span style="color: #008000;">"&lt;=&lt;"</span> <span style="color: #008000;">"&lt;-|"</span> <span style="color: #008000;">"&lt;~&gt;"</span> <span style="color: #008000;">"&lt;=|"</span> <span style="color: #008000;">"&lt;~~"</span> <span style="color: #008000;">"&lt;$&gt;"</span> <span style="color: #008000;">"&lt;+&gt;"</span> <span style="color: #008000;">"&lt;/&gt;"</span> <span style="color: #008000;">"&lt;*&gt;"</span>
                             <span style="color: #008000;">"&lt;-&gt;"</span> <span style="color: #008000;">"&lt;="</span> <span style="color: #008000;">"&lt;|"</span> <span style="color: #008000;">"&lt;:"</span> <span style="color: #008000;">"&lt;&gt;"</span>  <span style="color: #008000;">"&lt;$"</span> <span style="color: #008000;">"&lt;-"</span> <span style="color: #008000;">"&lt;~"</span> <span style="color: #008000;">"&lt;+"</span> <span style="color: #008000;">"&lt;/"</span> <span style="color: #008000;">"&lt;*"</span><span style="color: #858580;">)</span>
                         <span style="color: #858580;">(</span>+ <span style="color: #008000;">"&lt;"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?:  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">":?&gt;"</span> <span style="color: #008000;">"::="</span> <span style="color: #008000;">":&gt;"</span> <span style="color: #008000;">":&lt;"</span> <span style="color: #008000;">":?"</span> <span style="color: #008000;">":="</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">":"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?=  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"=&gt;&gt;"</span> <span style="color: #008000;">"==&gt;"</span> <span style="color: #008000;">"=/="</span> <span style="color: #008000;">"=!="</span> <span style="color: #008000;">"=&gt;"</span> <span style="color: #008000;">"=:="</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"="</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?!  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"!=="</span> <span style="color: #008000;">"!="</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"!"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?&gt;  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"&gt;&gt;-"</span> <span style="color: #008000;">"&gt;&gt;="</span> <span style="color: #008000;">"&gt;=&gt;"</span> <span style="color: #008000;">"&gt;]"</span> <span style="color: #008000;">"&gt;:"</span> <span style="color: #008000;">"&gt;-"</span> <span style="color: #008000;">"&gt;="</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"&gt;"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?&amp;  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span>+ <span style="color: #008000;">"&amp;"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?|  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"|-&gt;"</span> <span style="color: #008000;">"|||&gt;"</span> <span style="color: #008000;">"||&gt;"</span> <span style="color: #008000;">"|=&gt;"</span> <span style="color: #008000;">"||-"</span> <span style="color: #008000;">"||="</span> <span style="color: #008000;">"|-"</span> <span style="color: #008000;">"|&gt;"</span> <span style="color: #008000;">"|]"</span> <span style="color: #008000;">"|}"</span> <span style="color: #008000;">"|="</span><span style="color: #858580;">)</span>
                         <span style="color: #858580;">(</span>+ <span style="color: #008000;">"|"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?.  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">".?"</span> <span style="color: #008000;">".="</span> <span style="color: #008000;">".-"</span> <span style="color: #008000;">"..&lt;"</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"."</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?+  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"+&gt;"</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"+"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?\[ ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"[&lt;"</span> <span style="color: #008000;">"[|"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?\{ ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #008000;">"{|"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?\? ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"?."</span> <span style="color: #008000;">"?="</span> <span style="color: #008000;">"?:"</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"?"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?#  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #858580;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"#_("</span> <span style="color: #008000;">"#["</span> <span style="color: #008000;">"#{"</span> <span style="color: #008000;">"#="</span> <span style="color: #008000;">"#!"</span> <span style="color: #008000;">"#:"</span> <span style="color: #008000;">"#_"</span> <span style="color: #008000;">"#?"</span> <span style="color: #008000;">"#("</span><span style="color: #858580;">)</span> <span style="color: #858580;">(</span>+ <span style="color: #008000;">"#"</span><span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?\; ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span>+ <span style="color: #008000;">";"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?_  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"_|_"</span> <span style="color: #008000;">"__"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?~  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">or</span> <span style="color: #008000;">"~~&gt;"</span> <span style="color: #008000;">"~~"</span> <span style="color: #008000;">"~&gt;"</span> <span style="color: #008000;">"~-"</span> <span style="color: #008000;">"~@"</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?$  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #008000;">"$&gt;"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?^  ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #008000;">"^="</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>?\] ,<span style="color: #907373;">(</span><span style="color: #0000FF;">rx</span> <span style="color: #008000;">"]#"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>apply <span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #709870;">(</span>char ligature-re<span style="color: #709870;">)</span>
           <span style="color: #709870;">(</span>set-char-table-range composition-function-table char
                                 `<span style="color: #907373;">(</span><span style="color: #6276BA;">[</span>,ligature-re 0 font-shape-gstring<span style="color: #6276BA;">]</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
         char/ligature-re<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5c6518" class="outline-3">
<h3 id="orgc5c6518"><span class="section-number-3">23.5.</span> Variables</h3>
<div class="outline-text-3" id="text-23-5">
<p>
It's finally time to set up some basic variables.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> ring-bell-function 'ignore<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> vc-follow-symlinks t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> all-the-icons-scale-factor 1.2<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> confirm-kill-processes nil<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> kill-buffer-query-functions nil<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>treemacs-load-theme <span style="color: #008000;">"all-the-icons"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>menu-bar-mode -1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>tool-bar-mode -1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>scroll-bar-mode -1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>counsel-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>setcdr <span style="color: #7388D6;">(</span>assoc 'counsel-M-x ivy-initial-inputs-alist<span style="color: #7388D6;">)</span> <span style="color: #008000;">""</span><span style="color: #707183;">)</span> <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Search by substring</span>
<span style="color: #8D8D84; font-style: italic;">;;</span><span style="color: #8D8D84; font-style: italic;">(global-tab-line-mode t)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> inferior-lisp-program <span style="color: #008000;">"sbcl"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setf</span> nyan-animate-nyancat t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setf</span> nyan-animation-frame-interval 0.05<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setf</span> nyan-wavy-trail t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq-default</span> cursor-type 'bar<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> geiser-active-implementations '<span style="color: #7388D6;">(</span>guile<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> geiser-default-implementation 'guile<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">my-org-html-export-theme</span> 'leuven<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Background transparency, finally supported since Emacs 29.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>set-frame-parameter nil 'alpha-background 96<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>add-to-list 'default-frame-alist '<span style="color: #7388D6;">(</span>alpha-background . 96<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Setup up spacious padding.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setf</span> spacious-padding-widths '<span style="color: #7388D6;">(</span><span style="color: #006FE0;">:internal-border-width</span> 8 <span style="color: #006FE0;">:right-divider-width</span> 16 <span style="color: #006FE0;">:scroll-bar-width</span> 0<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">define-globalized-minor-mode</span> <span style="color: #006699;">my-global-spacious-padding-mode</span> spacious-padding-mode
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>spacious-padding-mode 1<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>my-global-spacious-padding-mode 1<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Emacsclient requires fonts to be loaded on frame creation instead of daemon start.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">load-my-fonts</span> <span style="color: #7388D6;">(</span>frame<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>select-frame frame<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'default nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 120<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'fixed-pitch nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 120<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'variable-pitch nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Source Sans Pro"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 1.1<span style="color: #7388D6;">)</span>

  <span style="color: #7388D6;">(</span>set-face-attribute 'company-tooltip nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 120<span style="color: #7388D6;">)</span>


  <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Make the document title a bit bigger</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-document-title nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Source Sans Pro"</span> <span style="color: #006FE0;">:weight</span> 'bold <span style="color: #006FE0;">:height</span> 1.3<span style="color: #7388D6;">)</span>

  <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Make sure certain org faces use the fixed-pitch face when variable-pitch-mode is on</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-block nil <span style="color: #006FE0;">:foreground</span> nil <span style="color: #006FE0;">:inherit</span> 'fixed-pitch<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-table nil <span style="color: #006FE0;">:inherit</span> 'fixed-pitch<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-formula nil <span style="color: #006FE0;">:inherit</span> 'fixed-pitch<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-code nil <span style="color: #006FE0;">:inherit</span> '<span style="color: #909183;">(</span>shadow fixed-pitch<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-verbatim nil <span style="color: #006FE0;">:inherit</span> '<span style="color: #909183;">(</span>shadow fixed-pitch<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-special-keyword nil <span style="color: #006FE0;">:inherit</span> '<span style="color: #909183;">(</span>font-lock-comment-face fixed-pitch<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-meta-line nil <span style="color: #006FE0;">:inherit</span> '<span style="color: #909183;">(</span>font-lock-comment-face fixed-pitch<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'org-checkbox nil <span style="color: #006FE0;">:inherit</span> 'fixed-pitch<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">if</span> <span style="color: #7388D6;">(</span>daemonp<span style="color: #7388D6;">)</span>
    <span style="color: #7388D6;">(</span>add-hook 'after-make-frame-functions #'load-my-fonts<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>load-my-fonts <span style="color: #909183;">(</span>selected-frame<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Some window related stuff; supress opening the welcome screen for buffers opening files.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">when</span> <span style="color: #7388D6;">(</span>&gt; <span style="color: #909183;">(</span>length command-line-args<span style="color: #909183;">)</span> 1<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq</span> inhibit-splash-screen t<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-to-list 'default-frame-alist '<span style="color: #7388D6;">(</span>height . 44<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-to-list 'default-frame-alist '<span style="color: #7388D6;">(</span>width . 140<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> frame-resize-pixelwise t<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Windows has some rather strange encoding issues when UTF-8 isn't explicitly set as the default.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>prefer-coding-system 'utf-8<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-default-coding-systems 'utf-8<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-language-environment 'utf-8<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>set-selection-coding-system 'utf-8<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Company is used for code completion. Here is a basic setup.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">company-complete-common-or-cycle</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Company settings."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">when</span> <span style="color: #909183;">(</span>company-manual-begin<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">if</span> <span style="color: #709870;">(</span>eq last-command 'company-complete-common-or-cycle<span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span><span style="color: #0000FF;">let</span> <span style="color: #907373;">(</span><span style="color: #6276BA;">(</span>company-selection-wrap-around t<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span>call-interactively 'company-select-next<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>call-interactively 'company-complete-common<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>define-key company-active-map <span style="color: #7388D6;">[</span>tab<span style="color: #7388D6;">]</span> 'company-complete-common-or-cycle<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key company-active-map <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"TAB"</span><span style="color: #7388D6;">)</span> 'company-complete-common-or-cycle<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> company-insertion-on-trigger 'company-explicit-action-p<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'xref-backend-functions #'dumb-jump-xref-activate<span style="color: #707183;">)</span>
</pre>
</div>

<p>
And here we arrive at the global modes.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>global-display-line-numbers-mode -1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-prettify-symbols-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-company-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-flycheck-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-jinx-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>which-key-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>ivy-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-tree-sitter-mode 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>electric-pair-mode t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-hl-line-mode 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>desktop-save-mode -1<span style="color: #707183;">)</span>
<span style="color: #8D8D84; font-style: italic;">;;</span><span style="color: #8D8D84; font-style: italic;">(elcord-mode)</span>
<span style="color: #8D8D84; font-style: italic;">;</span><span style="color: #8D8D84; font-style: italic;">(nyan-mode t)</span>
<span style="color: #707183;">(</span>add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'scheme-mode-hook 'geiser-mode<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'prog-mode-hook #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>display-line-numbers-mode t<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org95f5589" class="outline-3">
<h3 id="org95f5589"><span class="section-number-3">23.6.</span> LSP servers</h3>
<div class="outline-text-3" id="text-23-6">
<p>
Set up LSP for supported modes.
</p>

<p>
C and C++ are really straightforward.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'c-mode-hook #'lsp<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'c++-mode-hook #'lsp<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Here I set Python to use a custom <code>venv</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'python-mode-hook <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                              <span style="color: #909183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">lsp-pyright</span><span style="color: #909183;">)</span>
                              <span style="color: #909183;">(</span>lsp-register-custom-settings
                               `<span style="color: #709870;">(</span><span style="color: #907373;">(</span><span style="color: #008000;">"python.pythonPath"</span> <span style="color: #008000;">"/home/nil/.py/bin/python"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                              <span style="color: #909183;">(</span>lsp<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Go requires a bit of simple configuration.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">lsp-go-install-save-hooks</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span>add-hook 'before-save-hook #'lsp-format-buffer t t<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>add-hook 'before-save-hook #'lsp-organize-imports t t<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>add-hook 'go-mode-hook <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                          <span style="color: #909183;">(</span>lsp-deferred<span style="color: #909183;">)</span>
                          <span style="color: #909183;">(</span>lsp-go-install-save-hooks<span style="color: #909183;">)</span>
                          <span style="color: #909183;">(</span><span style="color: #0000FF;">setq</span> tab-width 4<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Impatient mode for Markdown, more about this later.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'markdown-mode-hook #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                  <span style="color: #909183;">(</span>markdown-impatient-start<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Impatient mode live preview</span>
</pre>
</div>

<p>
Rainbow delimiters are a life-saver for Lisps!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'prog-mode-hook #'rainbow-delimiters-mode<span style="color: #707183;">)</span>
</pre>
</div>

<p>
I like to have the selected line clearly highlighted.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>set-face-attribute 'hl-line nil <span style="color: #006FE0;">:inherit</span> nil <span style="color: #006FE0;">:background</span> <span style="color: #008000;">"gray14"</span><span style="color: #707183;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">use lavender for leuven theme instead</span>
</pre>
</div>

<p>
Fix unicode in <code>vterm</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'vterm-mode-hook
          <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
            <span style="color: #909183;">(</span>set-buffer-process-coding-system 'utf-8-unix 'utf-8-unix<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>


<p>
Add the Guix development environment for Geiser along with the <code>tempel</code> completions.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">with-eval-after-load</span> 'geiser-guile
  <span style="color: #7388D6;">(</span>add-to-list 'geiser-guile-load-path <span style="color: #008000;">"~/guix"</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>add-to-list 'geiser-guile-load-path <span style="color: #008000;">"~/nonguix"</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>add-to-list 'geiser-guile-load-path <span style="color: #008000;">"/etc/guix-modules"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">with-eval-after-load</span> 'tempel
  <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Ensure tempel-path is a list -- it may also be a string.</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #909183;">(</span>listp 'tempel-path<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">setq</span> tempel-path <span style="color: #709870;">(</span>list tempel-path<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>add-to-list 'tempel-path <span style="color: #008000;">"~/src/guix/etc/snippets/tempel/*"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Enable languages for the Jinx spell checker.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> jinx-languages <span style="color: #008000;">"en_US cs_CZ"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Set up EMMS playback with MPV.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">emms-setup</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>emms-all<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> emms-player-list '<span style="color: #7388D6;">(</span>emms-player-mpv<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Disable annoying keybind suggestions.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> suggest-key-bindings nil<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Here is a very minimal setup for org-agenda.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> org-log-done t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> calendar-week-start-day 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-to-list 'org-agenda-files <span style="color: #008000;">"~/org/agenda.org"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Automatically tangle config on save, currently disabled.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">org-babel-tangle-config</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">when</span> <span style="color: #909183;">(</span>string-equal <span style="color: #709870;">(</span>buffer-file-name<span style="color: #709870;">)</span>
                      <span style="color: #709870;">(</span>expand-file-name <span style="color: #008000;">"~/git/emacs-stuff/README.org"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>org-config-babel-evaluate nil<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>org-babel-tangle<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">(add-hook 'org-mode-hook</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">       (lambda ()</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">         (add-hook 'after-save-hook #'org-babel-tangle-config)))</span>
</pre>
</div>

<p>
Org-mode specific keybindings.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>define-key global-map <span style="color: #008000;">"\C-ck"</span> 'org-store-link<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key global-map <span style="color: #008000;">"\C-ca"</span> 'org-agenda<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Ensure <code>org-html-export-html</code> switches to the correct theme before exporting - this solves code legibility issues. It's a bit of a flashbang for a couple of seconds though&#x2026;
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-with-theme</span> <span style="color: #7388D6;">(</span>orig-fun <span style="color: #6434A3;">&amp;rest</span> args<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>load-theme my-org-html-export-theme<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">unwind-protect</span>
      <span style="color: #909183;">(</span>apply orig-fun args<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>disable-theme my-org-html-export-theme<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">with-eval-after-load</span> <span style="color: #008000;">"ox-html"</span>
  <span style="color: #7388D6;">(</span>advice-add 'org-html-export-to-html <span style="color: #006FE0;">:around</span> 'my-with-theme<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Jekyll export setup, I use this for my blog.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">ox-publish</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">with-eval-after-load</span> <span style="color: #008000;">"ox-publish"</span>
  <span style="color: #7388D6;">(</span>advice-add 'org-publish-current-project <span style="color: #006FE0;">:around</span> 'my-with-theme<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> org-publish-project-alist
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"lambdanil.github.io"</span>
         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Path to org files.</span>
         <span style="color: #006FE0;">:base-directory</span> <span style="color: #008000;">"~/git/lambdanil.github.io/org"</span>
         <span style="color: #006FE0;">:base-extension</span> <span style="color: #008000;">"org"</span>

         <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Path to Jekyll Posts</span>
         <span style="color: #006FE0;">:publishing-directory</span> <span style="color: #008000;">"~/git/lambdanil.github.io/_posts/"</span>
         <span style="color: #006FE0;">:recursive</span> t
         <span style="color: #006FE0;">:publishing-function</span> org-html-publish-to-html
         <span style="color: #006FE0;">:headline-levels</span> 4
         <span style="color: #006FE0;">:html-extension</span> <span style="color: #008000;">"html"</span>
         <span style="color: #006FE0;">:body-only</span> t<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Make <code>org-mode</code> a little bit prettier to look at.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'org-mode-hook
          <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
            <span style="color: #909183;">(</span>company-mode -1<span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span>toc-org-mode 1<span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span>org-bullets-mode 1<span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span><span style="color: #0000FF;">setq-local</span> face-remapping-alist '<span style="color: #709870;">(</span><span style="color: #907373;">(</span>default variable-pitch default<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span>set-face-attribute 'company-tooltip nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 120<span style="color: #909183;">)</span>
            <span style="color: #909183;">(</span><span style="color: #0000FF;">dolist</span> <span style="color: #709870;">(</span>face '<span style="color: #907373;">(</span><span style="color: #6276BA;">(</span>org-level-1 . 1.3<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-2 . 1.2<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-3 . 1.1<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-4 . 1.05<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-5 . 1.2<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-6 . 1.2<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-7 . 1.2<span style="color: #6276BA;">)</span>
                            <span style="color: #6276BA;">(</span>org-level-8 . 1.2<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
              <span style="color: #709870;">(</span>set-face-attribute <span style="color: #907373;">(</span>car face<span style="color: #907373;">)</span> nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> <span style="color: #907373;">(</span>cdr face<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">org-faces</span><span style="color: #707183;">)</span>

<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">Hide emphasis markers on formatted text</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> org-hide-emphasis-markers t<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now for presentations in Emacs using <code>org-present</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my/org-present-start</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq</span> visual-fill-column-width 160 <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Set the width</span>
        visual-fill-column-center-text t<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>visual-fill-column-mode 1<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>org-display-inline-images<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>visual-line-mode 1<span style="color: #7388D6;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Center text</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq-local</span> face-remapping-alist '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>default <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 1.6<span style="color: #907373;">)</span> variable-pitch<span style="color: #709870;">)</span> <span style="color: #8D8D84; font-style: italic;">; </span><span style="color: #8D8D84; font-style: italic;">Set font sizes</span>
                                     <span style="color: #709870;">(</span>header-line <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 4.0<span style="color: #907373;">)</span> variable-pitch<span style="color: #709870;">)</span>
                                     <span style="color: #709870;">(</span>org-document-title <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 1.75<span style="color: #907373;">)</span> org-document-title<span style="color: #709870;">)</span>
                                     <span style="color: #709870;">(</span>org-code <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 1.2<span style="color: #907373;">)</span> org-code<span style="color: #709870;">)</span>
                                     <span style="color: #709870;">(</span>org-verbatim <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 1.2<span style="color: #907373;">)</span> org-verbatim<span style="color: #709870;">)</span>
                                     <span style="color: #709870;">(</span>org-block <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 1.2<span style="color: #907373;">)</span> org-block<span style="color: #709870;">)</span>
                                     <span style="color: #709870;">(</span>org-block-begin-line <span style="color: #907373;">(</span><span style="color: #006FE0;">:height</span> 0.7<span style="color: #907373;">)</span> org-block<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my/org-present-end</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span>visual-fill-column-mode 0<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>org-remove-inline-images<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>visual-line-mode 0<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq-local</span> face-remapping-alist '<span style="color: #909183;">(</span><span style="color: #709870;">(</span>default variable-pitch default<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>set-face-attribute 'company-tooltip nil <span style="color: #006FE0;">:font</span> <span style="color: #008000;">"Fira Code"</span> <span style="color: #006FE0;">:weight</span> 'medium <span style="color: #006FE0;">:height</span> 120<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>add-hook 'org-present-mode-hook 'my/org-present-start<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'org-present-mode-quit-hook 'my/org-present-end<span style="color: #707183;">)</span>
</pre>
</div>

<p>
This is for keybindings that should never be overwritten by minor modes.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defvar</span> <span style="color: #BA36A5;">my/keys-keymap</span> <span style="color: #7388D6;">(</span>make-keymap<span style="color: #7388D6;">)</span>
  <span style="color: #036A07; font-style: italic;">"Keymap for my/keys-mode."</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">define-minor-mode</span> <span style="color: #006699;">my/keys-mode</span>
  <span style="color: #036A07; font-style: italic;">"Minor mode for my personal keybindings."</span>
  <span style="color: #006FE0;">:init-value</span> t
  <span style="color: #006FE0;">:global</span> t
  <span style="color: #006FE0;">:keymap</span> my/keys-keymap<span style="color: #707183;">)</span>

<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">The keymaps in `</span><span style="color: #D0372D; font-style: italic;">emulation-mode-map-alists</span><span style="color: #8D8D84; font-style: italic;">' take precedence over</span>
<span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">`</span><span style="color: #D0372D; font-style: italic;">minor-mode-map-alist</span><span style="color: #8D8D84; font-style: italic;">'</span>
<span style="color: #707183;">(</span>add-to-list 'emulation-mode-map-alists
             `<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span>my/keys-mode . ,my/keys-keymap<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cfc5a0" class="outline-3">
<h3 id="org6cfc5a0"><span class="section-number-3">23.7.</span> Functions</h3>
<div class="outline-text-3" id="text-23-7">
<p>
Some straightforward functions here, used to make my Emacs life a little easier.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-kill-buffer-and-window</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Kill the current buffer and delete the selected window."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>window-to-delete <span style="color: #907373;">(</span>selected-window<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>buffer-to-kill <span style="color: #907373;">(</span>current-buffer<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>delete-window-hook <span style="color: #907373;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #6276BA;">()</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">ignore-errors</span> <span style="color: #858580;">(</span>delete-window<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">unwind-protect</span>
        <span style="color: #709870;">(</span><span style="color: #0000FF;">progn</span>
          <span style="color: #907373;">(</span>add-hook 'kill-buffer-hook delete-window-hook t t<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #0000FF;">if</span> <span style="color: #6276BA;">(</span>kill-buffer <span style="color: #858580;">(</span>current-buffer<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
              <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">If `</span><span style="color: #D0372D; font-style: italic;">delete-window</span><span style="color: #8D8D84; font-style: italic;">' failed before, we rerun it to regenerate</span>
              <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">the error so it can be seen in the echo area.</span>
              <span style="color: #6276BA;">(</span><span style="color: #0000FF;">when</span> <span style="color: #858580;">(</span>eq <span style="color: #80A880;">(</span>selected-window<span style="color: #80A880;">)</span> window-to-delete<span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>delete-window<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">new-vterm</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>current-prefix-arg '<span style="color: #907373;">(</span>4<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">emulate C-u</span>
    <span style="color: #909183;">(</span>call-interactively 'vterm<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">dired-open-file</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"In Dired, open the file named on this line."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let*</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>file <span style="color: #907373;">(</span>dired-get-filename nil t<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>call-process <span style="color: #008000;">"xdg-open"</span> nil 0 nil file<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">insert-above-and-jump</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Insert line above current line."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>beginning-of-line<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>newline-and-indent<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>forward-line -1<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>indent-according-to-mode<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">insert-line-below-and-jump</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Insert line below current line."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>end-of-line<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>newline-and-indent<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-enlarge-window-horizontally</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Enlarge window horizontally."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>enlarge-window-horizontally 4<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-shrink-window-horizontally</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Shrink window horizontally."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>shrink-window-horizontally 4<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-erc-channel-search</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>insert <span style="color: #008000;">"/msg alis LIST **"</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
I use <code>tempel</code> for inserting snippets. This is copied right from their docs!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">tempel-setup-capf</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">setq-local</span> completion-at-point-functions
              <span style="color: #909183;">(</span>cons #'tempel-expand
                    completion-at-point-functions<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Sometimes I like to take quick notes in Markdown with impatient mode used for a preview feature.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">markdown-html</span> <span style="color: #7388D6;">(</span>buffer<span style="color: #7388D6;">)</span>
  <span style="color: #036A07; font-style: italic;">"Markdown HTML filter, supply BUFFER."</span>
  <span style="color: #7388D6;">(</span>princ <span style="color: #909183;">(</span><span style="color: #0000FF;">with-current-buffer</span> buffer
           <span style="color: #709870;">(</span>format <span style="color: #008000;">"&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;title&gt;Impatient Markdown&lt;/title&gt;&lt;xmp theme=\"united\" style=\"display:none;\"&gt; %s  &lt;/xmp&gt;&lt;script src=\"http://ndossougbe.github.io/strapdown/dist/strapdown.js\"&gt;&lt;/script&gt;&lt;/html&gt;"</span> <span style="color: #907373;">(</span>buffer-substring-no-properties <span style="color: #6276BA;">(</span>point-min<span style="color: #6276BA;">)</span> <span style="color: #6276BA;">(</span>point-max<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
         <span style="color: #909183;">(</span>current-buffer<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">markdown-impatient-start</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Start impatient mode with filter."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>impatient-mode<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>httpd-start<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>imp-set-user-filter 'markdown-html<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org917a9c3" class="outline-3">
<h3 id="org917a9c3"><span class="section-number-3">23.8.</span> Keybindings</h3>
<div class="outline-text-3" id="text-23-8">
<p>
Finally we get to my extensive custom keybindings. I try to keep these to as few as possible, to avoid forgetting them over time.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-d"</span><span style="color: #7388D6;">)</span> 'kill-line<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-l"</span><span style="color: #7388D6;">)</span> 'forward-char<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-h"</span><span style="color: #7388D6;">)</span> 'backward-char<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-k"</span><span style="color: #7388D6;">)</span> 'previous-line<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-j"</span><span style="color: #7388D6;">)</span> 'next-line<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-l"</span><span style="color: #7388D6;">)</span> 'forward-word<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-h"</span><span style="color: #7388D6;">)</span> 'backward-word<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-j"</span><span style="color: #7388D6;">)</span> 'forward-paragraph<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-k"</span><span style="color: #7388D6;">)</span> 'backward-paragraph<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-c"</span><span style="color: #7388D6;">)</span> 'compile<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-b"</span><span style="color: #7388D6;">)</span> 'ivy-switch-buffer<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-p"</span><span style="color: #7388D6;">)</span> 'other-window<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-o"</span><span style="color: #7388D6;">)</span> 'insert-line-above-and-jump<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-v"</span><span style="color: #7388D6;">)</span> 'set-mark-command<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"&lt;backtab&gt;"</span><span style="color: #7388D6;">)</span> 'indent-rigidly<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-="</span><span style="color: #7388D6;">)</span> 'indent-region<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-&#167;"</span><span style="color: #7388D6;">)</span> 'scroll-down-line<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-&#367;"</span><span style="color: #7388D6;">)</span> 'scroll-up-line<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-&#367;"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>scroll-up 4<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-&#167;"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>scroll-down 4<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-x c"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span> <span style="color: #909183;">(</span>load-file <span style="color: #008000;">"~/.emacs"</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c r"</span><span style="color: #7388D6;">)</span> 'replace-regexp<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-/"</span><span style="color: #7388D6;">)</span> 'undo-redo<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-/"</span><span style="color: #7388D6;">)</span> 'undo-redo<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c n"</span><span style="color: #7388D6;">)</span> 'elfeed<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c y"</span><span style="color: #7388D6;">)</span> 'yank-from-kill-ring<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c p"</span><span style="color: #7388D6;">)</span> 'treemacs<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c l"</span><span style="color: #7388D6;">)</span> 'treemacs-select-directory<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c t"</span><span style="color: #7388D6;">)</span> 'new-vterm<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-w"</span><span style="color: #7388D6;">)</span> 'copy-region-as-kill<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c h"</span><span style="color: #7388D6;">)</span> 'help<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-M-h"</span><span style="color: #7388D6;">)</span> 'previous-buffer<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-M-l"</span><span style="color: #7388D6;">)</span> 'next-buffer<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c i"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                             <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>erc-tls<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c v"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                             <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>split-window-horizontally<span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>run-with-idle-timer 0.05 nil
                                                                  'windmove-right<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c c"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                             <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>split-window-vertically<span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>run-with-idle-timer 0.05 nil
                                                                  'windmove-down<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c q"</span><span style="color: #7388D6;">)</span> 'delete-window<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c C-q"</span><span style="color: #7388D6;">)</span> 'my-kill-buffer-and-window<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c d"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">(</span>command<span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span> <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>read-shell-command <span style="color: #008000;">"$ "</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                                             <span style="color: #909183;">(</span>start-process-shell-command command nil command<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>global-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c w"</span><span style="color: #7388D6;">)</span> 'eww-switch-to-buffer<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>global-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c C-w"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                    <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                    <span style="color: #909183;">(</span><span style="color: #0000FF;">let</span> <span style="color: #709870;">(</span><span style="color: #907373;">(</span>current-prefix-arg '<span style="color: #6276BA;">(</span>4<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">emulate C-u</span>
                                      <span style="color: #709870;">(</span>eww <span style="color: #907373;">(</span>read-string <span style="color: #008000;">"Enter URL: "</span> <span style="color: #008000;">"https://google.com"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key my/keys-keymap <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"M-+"</span><span style="color: #7388D6;">)</span> 'tempel-complete<span style="color: #707183;">)</span>
</pre>
</div>

<p>
These bindings are defined separately in the EXWM config, so they aren't necessary when using EXWM.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">when</span> <span style="color: #7388D6;">(</span>not use-exwm<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>define-key my/keys-keymap <span style="color: #909183;">(</span>kbd <span style="color: #008000;">"C-&lt;return&gt;"</span><span style="color: #909183;">)</span> 'new-vterm<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>define-key my/keys-keymap <span style="color: #909183;">(</span>kbd <span style="color: #008000;">"C-)"</span><span style="color: #909183;">)</span> #'<span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #709870;">()</span> <span style="color: #709870;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>enlarge-window-horizontally 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>define-key my/keys-keymap <span style="color: #909183;">(</span>kbd <span style="color: #008000;">"C-&#250;"</span><span style="color: #909183;">)</span> #'<span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #709870;">()</span> <span style="color: #709870;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>shrink-window-horizontally 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>define-key my/keys-keymap <span style="color: #909183;">(</span>kbd <span style="color: #008000;">"M-&#250;"</span><span style="color: #909183;">)</span> #'<span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #709870;">()</span> <span style="color: #709870;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>shrink-window 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>define-key my/keys-keymap <span style="color: #909183;">(</span>kbd <span style="color: #008000;">"M-)"</span><span style="color: #909183;">)</span> #'<span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #709870;">()</span> <span style="color: #709870;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #709870;">)</span> <span style="color: #709870;">(</span>enlarge-window 2<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Some mode-specific bindings are added here.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>add-hook 'common-lisp-mode-hook #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                     <span style="color: #909183;">(</span>local-set-key <span style="color: #709870;">(</span>kbd <span style="color: #008000;">"C-c d"</span><span style="color: #709870;">)</span> 'sly-eval-defun<span style="color: #909183;">)</span>
                                     <span style="color: #909183;">(</span>local-set-key <span style="color: #709870;">(</span>kbd <span style="color: #008000;">"C-c r"</span><span style="color: #709870;">)</span> 'sly-eval-region<span style="color: #909183;">)</span>
                                     <span style="color: #909183;">(</span>local-set-key <span style="color: #709870;">(</span>kbd <span style="color: #008000;">"C-c b"</span><span style="color: #709870;">)</span> 'sly-eval-buffer<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key dired-mode-map <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c o"</span><span style="color: #7388D6;">)</span> 'dired-open-file<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>define-key dired-mode-map <span style="color: #7388D6;">[</span>mouse-2<span style="color: #7388D6;">]</span> 'dired-mouse-find-file<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'emacs-lisp-mode-hook #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>local-set-key <span style="color: #709870;">(</span>kbd <span style="color: #008000;">"C-c e"</span><span style="color: #709870;">)</span> 'eval-region<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'erc-mode-hook #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                        <span style="color: #909183;">(</span>local-set-key <span style="color: #709870;">(</span>kbd <span style="color: #008000;">"C-c s"</span><span style="color: #709870;">)</span> 'my-erc-channel-search<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'prog-mode-hook 'tempel-setup-capf<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'text-mode-hook 'tempel-setup-capf<span style="color: #707183;">)</span>
</pre>
</div>

<p>
Setup elfeed for news.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> elfeed-feeds
      '<span style="color: #7388D6;">(</span><span style="color: #909183;">(</span><span style="color: #008000;">"https://www.root.cz/rss/clanky"</span> root.cz<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"https://www.root.cz/rss/zpravicky"</span> root.cz<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"https://forum.root.cz/index.php?action=.xml;type=rss2;limit=30;sa=news"</span> root.cz forum<span style="color: #909183;">)</span>
        <span style="color: #909183;">(</span><span style="color: #008000;">"https://protesilaos.com/master.xml"</span> protesilaos.com<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>add-hook 'elfeed-show-mode-hook
          <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>buffer-face-set 'variable-pitch<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
And we have reached the end of the main Emacs file!
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">provide</span> '<span style="color: #D0372D;">.emacs</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Let's move onto EXWM configuration next.
</p>
</div>
</div>

<div id="outline-container-orga29b357" class="outline-3">
<h3 id="orga29b357"><span class="section-number-3">23.9.</span> .exwm.el</h3>
<div class="outline-text-3" id="text-23-9">
<p>
The EXWM configuration is stored in a separate file from the Emacs config, this helps keep it modular and easy to switch on or off.
</p>

<p>
Eensure the <code>exwm</code> package is installed first.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">unless</span> <span style="color: #7388D6;">(</span>package-installed-p 'exwm<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span>package-install 'exwm<span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Now we <code>require</code> all the necessary packages and set a few defaults.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">exwm</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">exwm-config</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-config-default<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">require</span> '<span style="color: #D0372D;">exwm-systemtray</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-systemtray-enable<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> exwm-systemtray-height 16<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> exwm-layout-show-all-buffers t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> exwm-workspace-show-all-buffers t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> exwm-workspace-number 4<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>display-time-mode 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span><span style="color: #0000FF;">setq</span> display-time-24hr-format t<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>call-process <span style="color: #008000;">"/usr/bin/bash"</span> <span style="color: #008000;">"~/.loginctl"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Define some custom functions.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">new-vterm-exwm</span> <span style="color: #7388D6;">()</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>current-prefix-arg '<span style="color: #907373;">(</span>4<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">emulate C-u</span>
    <span style="color: #909183;">(</span>call-interactively 'vterm<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">exwm-move-window-to-workspace</span> <span style="color: #7388D6;">(</span>workspace-number<span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>frame <span style="color: #907373;">(</span>exwm-workspace--workspace-from-frame-or-index workspace-number<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>id <span style="color: #907373;">(</span>exwm--buffer-&gt;id <span style="color: #6276BA;">(</span>window-buffer<span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>exwm-workspace-move-window frame id<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>


<span style="color: #707183;">(</span><span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">exwm-set-key-progn</span> <span style="color: #7388D6;">(</span>key <span style="color: #6434A3;">&amp;rest</span> body<span style="color: #7388D6;">)</span>
  `<span style="color: #7388D6;">(</span>exwm-input-set-key <span style="color: #909183;">(</span>kbd ,key<span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span><span style="color: #0000FF;">lambda</span><span style="color: #709870;">()</span>
                         ,@body<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">exwm-key-to-workspace</span> <span style="color: #7388D6;">(</span>key workspace<span style="color: #7388D6;">)</span>
  `<span style="color: #7388D6;">(</span>exwm-set-key-progn ,key
                       <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span>exwm-workspace-switch ,workspace<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">exwm-key-send-to-workspace</span> <span style="color: #7388D6;">(</span>key workspace<span style="color: #7388D6;">)</span>
  `<span style="color: #7388D6;">(</span>exwm-set-key-progn ,key
                       <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span>exwm-move-window-to-workspace ,workspace<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defmacro</span> <span style="color: #006699;">exwm-key-to-command</span> <span style="color: #7388D6;">(</span>key command<span style="color: #7388D6;">)</span>
  `<span style="color: #7388D6;">(</span>exwm-set-key-progn ,key
                       <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                       <span style="color: #909183;">(</span>start-process-shell-command ,command nil ,command<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">defun</span> <span style="color: #006699;">my-kill-buffer-and-window</span> <span style="color: #7388D6;">()</span>
  <span style="color: #036A07; font-style: italic;">"Kill the current buffer and delete the selected window."</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #7388D6;">)</span>
  <span style="color: #7388D6;">(</span><span style="color: #0000FF;">let</span> <span style="color: #909183;">(</span><span style="color: #709870;">(</span>window-to-delete <span style="color: #907373;">(</span>selected-window<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>buffer-to-kill <span style="color: #907373;">(</span>current-buffer<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">(</span>delete-window-hook <span style="color: #907373;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #6276BA;">()</span> <span style="color: #6276BA;">(</span><span style="color: #0000FF;">ignore-errors</span> <span style="color: #858580;">(</span>delete-window<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span><span style="color: #0000FF;">unwind-protect</span>
        <span style="color: #709870;">(</span><span style="color: #0000FF;">progn</span>
          <span style="color: #907373;">(</span>add-hook 'kill-buffer-hook delete-window-hook t t<span style="color: #907373;">)</span>
          <span style="color: #907373;">(</span><span style="color: #0000FF;">if</span> <span style="color: #6276BA;">(</span>kill-buffer <span style="color: #858580;">(</span>current-buffer<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span>
              <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">If `</span><span style="color: #D0372D; font-style: italic;">delete-window</span><span style="color: #8D8D84; font-style: italic;">' failed before, we rerun it to regenerate</span>
              <span style="color: #8D8D84; font-style: italic;">;; </span><span style="color: #8D8D84; font-style: italic;">the error so it can be seen in the echo area.</span>
              <span style="color: #6276BA;">(</span><span style="color: #0000FF;">when</span> <span style="color: #858580;">(</span>eq <span style="color: #80A880;">(</span>selected-window<span style="color: #80A880;">)</span> window-to-delete<span style="color: #858580;">)</span>
                <span style="color: #858580;">(</span>delete-window<span style="color: #858580;">)</span><span style="color: #6276BA;">)</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Time to configure the keybindings.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-&#233;"</span> 0<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-+"</span> 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-&#283;"</span> 2<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-&#353;"</span> 3<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-&#269;"</span> 4<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-workspace <span style="color: #008000;">"s-&#345;"</span> 5<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-0"</span> 0<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-1"</span> 1<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-2"</span> 2<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-3"</span> 3<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-4"</span> 4<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-send-to-workspace <span style="color: #008000;">"s-5"</span> 5<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-Q"</span><span style="color: #7388D6;">)</span> #'my-kill-buffer-and-window<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-R"</span><span style="color: #7388D6;">)</span> #'exwm-reset<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-x"</span><span style="color: #7388D6;">)</span> #'exwm-input-toggle-keyboard<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-h"</span><span style="color: #7388D6;">)</span> #'windmove-left<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-j"</span><span style="color: #7388D6;">)</span> #'windmove-down<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-k"</span><span style="color: #7388D6;">)</span> #'windmove-up<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-l"</span><span style="color: #7388D6;">)</span> #'windmove-right<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-q"</span><span style="color: #7388D6;">)</span> #'delete-window<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"C-c q"</span><span style="color: #7388D6;">)</span> #'kill-current-buffer<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-,"</span><span style="color: #7388D6;">)</span> #'exwm-workspace-switch-to-buffer<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-f"</span><span style="color: #7388D6;">)</span> #'exwm-layout-toggle-fullscreen<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-&lt;return&gt;"</span><span style="color: #7388D6;">)</span> #'new-vterm-exwm<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-c"</span><span style="color: #7388D6;">)</span> #'vterm<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-d"</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">(</span>command<span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span> <span style="color: #709870;">(</span>list <span style="color: #907373;">(</span>read-shell-command <span style="color: #008000;">"$ "</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span>start-process-shell-command command nil command<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-b"</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                  <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span>split-window-vertically<span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span>run-with-idle-timer 0.05 nil <span style="color: #709870;">(</span><span style="color: #0000FF;">lambda</span><span style="color: #907373;">()</span> <span style="color: #907373;">(</span>windmove-down<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-v"</span><span style="color: #7388D6;">)</span> <span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span>
                                  <span style="color: #909183;">(</span><span style="color: #0000FF;">interactive</span><span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span>split-window-horizontally<span style="color: #909183;">)</span>
                                  <span style="color: #909183;">(</span>run-with-idle-timer 0.05 nil <span style="color: #709870;">(</span><span style="color: #0000FF;">lambda</span><span style="color: #907373;">()</span> <span style="color: #907373;">(</span>windmove-right<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-L"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>enlarge-window-horizontally 2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-H"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>shrink-window-horizontally 2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-J"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>shrink-window 2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-K"</span><span style="color: #7388D6;">)</span> #'<span style="color: #7388D6;">(</span><span style="color: #0000FF;">lambda</span> <span style="color: #909183;">()</span> <span style="color: #909183;">(</span>enlarge-window 2<span style="color: #909183;">)</span><span style="color: #7388D6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-F"</span><span style="color: #7388D6;">)</span> #'exwm-floating-toggle-floating<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-&lt;tab&gt;"</span><span style="color: #7388D6;">)</span> #'exwm-workspace-add<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-input-set-key <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"s-&lt;iso-lefttab&gt;"</span><span style="color: #7388D6;">)</span> #'exwm-workspace-delete<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-command <span style="color: #008000;">"s-M"</span> <span style="color: #008000;">"pavucontrol"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-command <span style="color: #008000;">"&lt;XF86AudioRaiseVolume&gt;"</span> <span style="color: #008000;">"pamixer -i 5"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-command <span style="color: #008000;">"&lt;XF86AudioLowerVolume&gt;"</span> <span style="color: #008000;">"pamixer -d 5"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-command <span style="color: #008000;">"&lt;XF86AudioMute&gt;"</span> <span style="color: #008000;">"pamixer -t"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>exwm-key-to-command <span style="color: #008000;">"s-&lt;f6&gt;"</span> <span style="color: #008000;">"pamixer --default-source -t"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
Finally push the super key and escape as <code>exwm-input-prefix-keys</code>.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #707183;">(</span><span style="color: #0000FF;">push</span> ?\s-  exwm-input-prefix-keys<span style="color: #707183;">)</span>

<span style="color: #707183;">(</span><span style="color: #0000FF;">push</span> <span style="color: #7388D6;">(</span>kbd <span style="color: #008000;">"&lt;escape&gt;"</span><span style="color: #7388D6;">)</span> exwm-input-prefix-keys<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org88c9411" class="outline-2">
<h2 id="org88c9411"><span class="section-number-2">24.</span> Non-Guix Services and dependencies</h2>
<div class="outline-text-2" id="text-24">
<p>
Some additional services may need to be enabled on non-guix distributions.
</p>
<ul class="org-ul">
<li><code>sudo systemctl enable zram</code></li>
<li><code>sudo systemctl enable bluetooth</code></li>
</ul>

<p>
And that's all for the configs!
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: (Î» () nil)</p>
<p class="date">Created: 2024-03-10 Ne 13:04</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>